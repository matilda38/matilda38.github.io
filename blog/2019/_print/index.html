<!doctype html>
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.75.1" /><link rel="canonical" type="text/html" href="/blog/2019/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>2019 | 한국어 버전 타이틀</title><meta property="og:title" content="2019" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/blog/2019/" />
<meta property="og:site_name" content="한국어 버전 타이틀" />
<meta itemprop="name" content="2019">
<meta itemprop="description" content="">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="2019"/>
<meta name="twitter:description" content=""/>





<link rel="preload" href="/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css" as="style">
<link href="/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>




  </head>
  <body class="td-section td-blog">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zM197.0804 232.033c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zM197.0804 177.6188c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zM197.5309 286.4723c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zM197.0804 340.5784c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">한국어 버전 타이틀</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/blog/" ><span class="active">Blog</span></a>
			</li>
			
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Korean
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/en/">English</a>
	
</div>
			</li>
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 사이트에서 검색…" aria-label="사이트에서 검색…" autocomplete="off">

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/blog/2019/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">2019</h1>





    <ul>
    
  
  
  
  

  
    
    
	

    <li><a href="#pg-488f0ebb0a422b1ed493c128b199c91b">Wine list for beginners</a></li>



    
  
    
    
	

    <li><a href="#pg-55a315b9f51fcea8969bee7d245547e1">Passing Slice to a function</a></li>



    
  
    
    
	

    <li><a href="#pg-ab9a7f95cb158b008022bd723c3ae945">gorm-postgresql 사용 주의</a></li>



    
  
    
    
	

    <li><a href="#pg-d91144f1aecf6aa2e42f313a5c43cf5a">string split</a></li>



    
  
    
    
	

    <li><a href="#pg-ac3992195bdfe2da845c2fc8c030e646">goland tips</a></li>



    
  
    
    
	

    <li><a href="#pg-6b0851710c0f814de79273292d4588ce">DDA 스터디</a></li>



    
  
    
    
	

    <li><a href="#pg-b79aff5e78952dc2748e8e69b6628636">클로저를 고루틴으로 실행할때 주의할점.</a></li>



    
  
    
    
	

    <li><a href="#pg-106c32897074f874669df46ca3978460">concurrency is not parallelism</a></li>



    
  
    
    
	

    <li><a href="#pg-2e3cdd17f1d9860366f68fd26bb2ec6f">aws-lambda-in-go</a></li>



    
  
    
    
	

    <li><a href="#pg-27df5ade3010b14a6dd5ca2b3146b1f8">scripting in github action</a></li>



    
  
    
    
	

    <li><a href="#pg-5b9d5d2318c342f6b5f9c03d26400563">ssh tunneling</a></li>



    
  
    
    
	

    <li><a href="#pg-1b756cfc3b08669fde63190db6b73a87">aws-lambda</a></li>



    
  
    
    
	

    <li><a href="#pg-db4a5139db28ab728d63e5fb8dec0209">docker-compose up</a></li>



    
  
    
    
	

    <li><a href="#pg-854ed346fc46732b8d436bcd5617026d">rune ?</a></li>



    
  
    
    
	

    <li><a href="#pg-67575c6ae03ca092937fd8f8f3c18a49">Django tutorial</a></li>



    
  
    
    
	

    <li><a href="#pg-8bdfe4098c42101747264a2bec233bd7">reflect 어떻게 쓰지 - 2</a></li>



    
  
    
    
	

    <li><a href="#pg-d53c72cb81c4e15423fcac286eacb365">reflect 어떻게 쓰지 - 1</a></li>



    
  
    
    
	

    <li><a href="#pg-4cb1018c33a47db3bc3d07ddce484bf4">언니가 사준 맥 립스틱 색깔</a></li>



    
  
    
    
	

    <li><a href="#pg-2ba4924ed323a7f7575d27a5347cb5ff">How to study GOlang</a></li>



    
  
    
    
	

    <li><a href="#pg-e0452db584ade6c5afb908229e686e8b">리뷰해보고 싶은 Gin Boilerplate</a></li>



    
  
    
    
	

    <li><a href="#pg-f378d86b2613e0fa3334030ba313b7fb">Dataproc</a></li>



    
  
    
    
	

    <li><a href="#pg-433f8ffea0d4a2ddbdbae09c58e69202">Dataproc</a></li>



    
  
    
    
	

    <li><a href="#pg-5b7cccb8a01fb35797a2e436cba41ed8">VPC and NAT</a></li>



    
  
    
    
	

    <li><a href="#pg-cc8e3e9b4e558982e4f8ac1a2a319e49">golang slice</a></li>



    
  
    
    
	

    <li><a href="#pg-4224d92d0c2e1fd7e73c91c70622233f">VPC and NAT</a></li>



    
  
    
    
	

    <li><a href="#pg-85cddadd9e786089f6ba2938846297ab">Http connection reusing in Go</a></li>



    
  
    
    
	

    <li><a href="#pg-016edfdb0f84384ff5a6c8b520372ac4">VPC and NAT</a></li>



    
  
    
    
	

    <li><a href="#pg-01b5fccd3bc6dcf7ca4588c125302d5c">Data consistency</a></li>



    
  
    
    
	

    <li><a href="#pg-f5e9ba60b472dded5592163b23bd313d">AWS Sessions</a></li>



    
  
    
    
	

    <li><a href="#pg-da90d78651569b6db86744d37c606564">Web Developer 101</a></li>



    
  
    
    
	

    <li><a href="#pg-7e135a0c12503feae8c395be8d8bba88">Go JSON</a></li>



    
  
    
    
	

    <li><a href="#pg-2a4201f5d0697dc78990ecced3be44b5">Panic Recover</a></li>



    
  
    
    
	

    <li><a href="#pg-b788bed69318261c2d9c7ad15e0672f1">mac local kubernetes setup</a></li>



    
  
    
    
	

    <li><a href="#pg-62c439d6d48797554a516e2000d975e3">golang nil check</a></li>



    
  
    
    
	

    <li><a href="#pg-d79c3fedd310c9fb9b42d7c0da7c295e">Kubernetes Deployment(삽질)</a></li>



    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    


  

<div class="td-content" style="">
    <h1 id="pg-488f0ebb0a422b1ed493c128b199c91b">Wine list for beginners</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-12-30" class="text-muted">2019.12.30</time>
        
	</div>
	<p>부담스럽지 않은 입문용 쉬라즈/멜롯 세미나 를 진행한다면 시음하고 싶은 와인 리스트</p>
<p>d&rsquo;Arenberg, Footbolt Shiraz 2016
다렌버그, 풋볼트 쉬라즈 2016</p>
<p>와인 구매하는 법</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-55a315b9f51fcea8969bee7d245547e1">Passing Slice to a function</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-12-26" class="text-muted">2019.12.26</time>
        
	</div>
	<p>절차지향 프로그래밍의 가장 흔한 특징은 배열 개념이다. 배열은 간단한 것처럼 보이지만 우리가 언어에 배열을 적용할때에는 몇가지 답변해야할 문제들이 있다.</p>
<ul>
<li>고정된 사이즈인가 변수인가?</li>
<li>사이즈가 타입의 부분인가?</li>
<li>다차원 배열은 어떻게 생겼는가?</li>
<li>빈 배열이 의미가 있는가?</li>
</ul>
<p>이 문제들의 답변은 배열이 그저 언어의 특징인지, 디자인의 핵심부분인지에 영향을 끼친다.</p>
<p>Go에서는 고정 길이 배열을 기반으로 만들어져 유동적이고 확장가능한 데이터 구조를 가지는 Slice가 이 문제의 답변의 핵심이다.</p>
<h1 id="배열">배열</h1>
<p>배열은 고에서 중요한 부분이지만, 어떤 건물의 토대처럼 눈에 보이는 컴포넌트들 아래 숨겨져있다. 우리는 좀 더 흥미로운 주제인 Slice를 이야기하기 전에 배열에 대해서 간단히 짚고 넘어가야한다.</p>
<p>배열은 사이즈가 타입의 일부이고, 이는 표현성을 한정시키기 떄문에 Go 프로그램에서 그닥 잘 보이지 않는다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">buffer</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">256</span><span style="color:#000;font-weight:bold">]</span><span style="color:#204a87;font-weight:bold">byte</span>
</code></pre></div><p>이는 buffer라는 256바이트짜리 변수를 선언한다. 이 변수 buffer의 타입은 256이라는 사이즈를 포함한다. 이 배열과 관련된 데이터는 딱 원소들의 배열일 것이다. 설계상으로 아마 이렇게 메모리에 있을 것이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">buffer: byte byte byte ... <span style="color:#0000cf;font-weight:bold">256</span> <span style="color:#204a87">times</span> ... byte byte byte
</code></pre></div><p>즉, 이 변수는 256 바이트의 데이터&quot;만&quot; 저장하고 있다. 이 원소들은 buffer[0], buffer[1] 같은 친숙한 인덱싱 문법으로 접근할 수 있다. 배열은 보통 slice를 위한 저장소로서의 목적으로 가장 많이 사용된다.</p>
<h1 id="slice">slice</h1>
<p>slice를 쓰기위해서는 그것들이 무엇이고 무엇을 하는지 정확히 이해를 하고 있어야한다.</p>
<p>slice는 slice 변수 그 자체와는 별개로 저장되는 배열의 연속적인 섹션을 표현하기 위한 자료구조이다. slice는 배열이 아니다. slice는 배열의 일부를 나타낸다. 우리 buffer 배열이 있다고 할때, 배열을 slicing 함으로써 우리는 100에서 150까지의 원소를 나타내는 slice를 만들 수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">slice</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">byte</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">150</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic">// var slice = buffer[100:150]
</span><span style="color:#8f5902;font-style:italic">// slice := buffer[100:150]
</span></code></pre></div><p>slice 변수는 정확히 무엇일까? 정확히 그런건 아니지만, 일단 slice를 길이와 배열의 원소에 대한 포인터, 두 개 원소를 가지는 자료구조라고 생각해보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">sliceHeader</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">Length</span>        <span style="color:#204a87;font-weight:bold">int</span>
    <span style="color:#000">ZerothElement</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#204a87;font-weight:bold">byte</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000">slice</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">sliceHeader</span><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">Length</span><span style="color:#000;font-weight:bold">:</span>        <span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">ZerothElement</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">],</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>물론 이건, 그냥 예시다. 사실 sliceHeader는 프로그래머들에게 보이는 영역이 아니고, 원소의 포인터의 타입이 원소 타입에 의존적이지만, 이 예시는 slice의 원리를 설명하고 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">slice2</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic">// 밑에 sliceHeader 구조체는 이런식으로 생겼을것이다.
</span><span style="color:#8f5902;font-style:italic">// slice2 := sliceHeader {
</span><span style="color:#8f5902;font-style:italic">// 	 Length: 5,
</span><span style="color:#8f5902;font-style:italic">// 	 ZerothElement: &amp;buffer[105],
</span><span style="color:#8f5902;font-style:italic">// }
</span></code></pre></div><p>이 헤더가 buffer 변수에 저장되 있는 같은 배열을 가르키고 있다는 걸 주의해야한다.</p>
<p>또한 reslice할 수 있는데, slice를 slice해서 기존의 slice 구조체로 결과를 다시 저장하는 것을 의미한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">slice</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>이것의 sliceHeader 구조는 slice2 변수꺼와 아예 같을 것이다. slice를 truncate할때와 같이, reslicing을 하는 경우는 종종 볼 수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">slice</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic">// sliceHeader {
</span><span style="color:#8f5902;font-style:italic">//	 Length: 3,
</span><span style="color:#8f5902;font-style:italic">//	 ZerothElement: &amp;buffer[106]
</span><span style="color:#8f5902;font-style:italic">// }
</span></code></pre></div><p>짬 찬 go 프로그래머가 slice header 에 대해서 말하는 걸 들은 적 있을 것이다. slice header는 사실 실제로 slice 변수가 가지고 있는 값이다. slice를 argument로 가지는 함수를 호출할때, 함수에 실제로 전달되는 건 sliceheader이다. slice header에는 사실 한가지 아이템이 더 있는데, 일단 슬라이스 헤더의 존재여부가 slice를 다루는 프로그램에 어떤 영향을 주는 지부터 알아본다.</p>
<h1 id="함수에-slice를-전달할때">함수에 slice를 전달할때</h1>
<p>Slice가 포인터를 포함하고 있지만 그자체로서는 &ldquo;값&quot;이라는 걸 이해하는 게 중요하다.</p>
<p>Slice는 포인터와 길이를 가지고 있는 구조체 값이다. 구조체를 가르키는 포인터가 아니다.</p>
<p>이전 예시에서 IndexRune을 호출할때 우리는 slice header의 복사본을 전달한것이다.</p>
<p>예를 들어,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">AddOneToEachElement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">slice</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">++</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>slice를 돌면서 값을 1씩 증가시키는 함수가 있다고 할때,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">slice</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">byte</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;before&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">AddOneToEachElement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;after&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>slice header가 <em>값</em>으로 전달된다고 하더라도, 헤더에는 배열의 원소를 가르키는 pointer가 있기 때문에, 기존 슬라이스 헤더와 함수에 전달된 복사된 헤더 모두 같은 배열을 가르킨다. 그러므로, 함수가 return될때 slice들의 원소 값들이 변경된 걸 확인할 수 있는 것이다.</p>
<p>함수 파라미터는 정말 <em>복사본</em>이다. 아래 예시에서 확인할 수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">SubtractOneFromLength</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">byte</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">slice</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">slice</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Before: len(slice) =&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">newSlice</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">SubtractOneFromLength</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;After:  len(slice) =&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;After:  len(newSlice) =&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">newSlice</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Go 에서 파라미터를 전달할때 Reference가 아닌, Value로 전달한다. Slice의 경우에도 마찬가지이다. 이는 Pointer와 길이를 가진 구조체 값이라고 할 수 있다.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-ab9a7f95cb158b008022bd723c3ae945">gorm-postgresql 사용 주의</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-12-20" class="text-muted">2019.12.20</time>
        
	</div>
	<p>gorm 을 통해 go 에서 orm을 사용하고 있었다. gorm은 mysql, postgresql 등 메인 dbms를 지원하면서도 꽤 편리하게 데이터베이스 operation들을 관리할 수 있었기 때문에 잘 사용하고 있었다.</p>
<p>계속 조회만 했었어서 Update 로직을 딱히 사용할 일이 없다가, 이번에 한번 사용할 일이 있어서 사용해보았다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">rdb</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Debug</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Table</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Where</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user_id = $1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">UserID</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">UpdateColumn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test_column&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">postgres</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Jsonb</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000">RawMessage</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">resBytes</span><span style="color:#000;font-weight:bold">})</span>
</code></pre></div><p>뭐 이런 코드였는데, 자꾸 에러가 발생하길래 뭐지싶어서 디버그 옵션을 키고 돌려봤다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pq: column <span style="color:#4e9a06">&#34;test_column&#34;</span> is of <span style="color:#204a87">type</span> jsonb but expression is of <span style="color:#204a87">type</span> text
UPDATE <span style="color:#4e9a06">&#34;testcases&#34;</span> SET <span style="color:#4e9a06">&#34;test_column&#34;</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;[123 34 99 111 ~ ]&#39;</span> WHERE <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">user_id</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;[123 34 99 111 ~ ]&#39;</span>
</code></pre></div><p>쿼리가 저렇게 찍혀있었다. 즉, 앞에 있는 where 절의 user_id 에 test_column 에 넣을 데이터가 덮어쓰기 되어있었다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">rdb</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Debug</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Table</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">UpdateColumn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test_column&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">postgres</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Jsonb</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000">RawMessage</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">resBytes</span><span style="color:#000;font-weight:bold">}).</span><span style="color:#000">Where</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user_id = $1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">UserID</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>혹시 몰라서 where 절의 위치를 바꿔봤는데 아예 where 절이 무시된다.</p>
<p><a href="http://gorm.io/docs/update.html">http://gorm.io/docs/update.html</a> 공식 documentation에서</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">db</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Table</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;users&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Where</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;id IN (?)&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">{</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">11</span><span style="color:#000;font-weight:bold">}).</span><span style="color:#000">Updates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">]</span><span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{}{</span><span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;hello&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;age&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">18</span><span style="color:#000;font-weight:bold">})</span>
<span style="color:#8f5902;font-style:italic">//// UPDATE users SET name=&#39;hello&#39;, age=18 WHERE id IN (10, 11);
</span></code></pre></div><p>위 코드가 정상 실행되는 걸 보니 mysql에서는 위와 같은 방식의 update가 정상적으로 실행되는 듯하다. 아마도 postgresql 의 placeholder 관련되서 버그가 있어서 안먹는것으로 추정된다.</p>
<p>Table에 Operation을 날리는게 아니라 Model 기준으로 Update을 수행하게 되면 정상적으로 동작하는 것을 확인했다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">rdb</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">UpdateColumn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test_column&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">postgres</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Jsonb</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000">RawMessage</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">resBytes</span><span style="color:#000;font-weight:bold">})</span>
</code></pre></div><p>Model은 gorm에서는 특정 Row를 가르킨다고 보면 된다. 따라서 Model 의 파라미터로 들어가는 user 객체에는 Id 컬럼이 반드시 채워져있어야한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">User</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">ID</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`gorm:&#34;id&#34;`</span>
	<span style="color:#000">Name</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`gorm:&#34;name&#34;`</span>
	<span style="color:#000">TestColumn</span> <span style="color:#000">postgres</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Jsonb</span> <span style="color:#4e9a06">`gorm:&#34;test_column&#34;`</span>
	<span style="color:#000">IsEnabled</span> <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#4e9a06">`gorm:&#34;is_enabled&#34;`</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">users</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#000">User</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">rdb</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Where</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;is_enabled = $1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Find</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">users</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span><span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">err</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>뭐 이런식으로 하면 user들을 query로 땡겨와서 slice 안에 넣어놓고 각 user의 특정 컬럼값을 Update하는 로직을 작성할 수 있을 것이다.
그동안은 Table 에 직접 Operation하는 것이 좀 더 명시적이라고 생각해서 그런식으로 코드를 작성했었는데, 위와 같이 Model기준으로 하는게 코드상 버그도 없고 공식 Documentation이나 gorm usage들에서 많이 사용하는 방식인 듯하다.</p>
<p>물론 Explict하게도 해결할 수 있다. 무식하지만 쿼리를 그냥 때리는 것이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">rdb</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Exec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;UPDATE test SET test_column=$1 WHERE user_id=$2&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">postgres</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Jsonb</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000">RawMessage</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">resBytes</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">UserID</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Error</span>
</code></pre></div><p>쿼리를 그냥 execute(실행)하면 사실 위와같은 문제는 해결 할 수 있다.</p>
<p>Model 기준으로 많이 사용하고 있으니, 한번 Model기준으로 앞으로 작성해보려고한다.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-d91144f1aecf6aa2e42f313a5c43cf5a">string split</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-12-10" class="text-muted">2019.12.10</time>
        
	</div>
	<p>Json diff를 뜨고 &ldquo;\n&quot;으로 split을 했는데 자꾸 예상한 길이보다 1씩 길게 나오는것이었다.
go 내장함수인 strings.Split 요놈이 문제인가 해서 한번 테스트를 해봤다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">hello</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;안녕하세요\n 반갑습니다.&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">rune</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>문제가 되는 문자열의 마지막 Rune이 U+000A, 즉 10이었다. 알고보니 이는 New line(개행문자)의 unicode중 하나였고, Split는 문제가 없었다. string 을 제대로 출력하고 테스트해보기 위해 rune을 활용하면 좋다.</p>
<blockquote>
<p>참고1: <a href="http://pyrasis.com/book/GoForTheReallyImpatient/Unit45/02">utf8 패키지 내 함수 참고자료</a>
golang은 모두 utf8 인코딩 기반이기 때문에, 한글이나 특수문자를 표현하기 위해 utf8 라이브러리 내의 여러가지 함수를 사용해보면 편하다.</p>
</blockquote>
<p>다만</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">hello</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;안녕하세요\n반갑습니다\n&#34;</span>
<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%q&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">strings</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">hello</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;\n&#34;</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#8f5902;font-style:italic">// [&#34;안녕하세요&#34;, &#34;반갑습니다&#34;, &#34;&#34;]
</span></code></pre></div><p>맨마지막에 저렇게 empty string이 나오는게 싫어서 저렇게 empty string을 제외하고 Split하는 방법에 대해 좀 찾아보니, 아래와 같은 함수를 찾았다. splitFn라는 함수에 separator 를 정의하고 해당 함수를 strings.FieldsFunc 라는 메소드에 파라미터로 넘기는 방식으로 Split을 수행하면 empty string이 무시된다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">splitFn</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">rune</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;\n&#39;</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%q&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">strings</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">FieldsFunc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">hello</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">splitFn</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#8f5902;font-style:italic">//[&#34;안녕하세요&#34; &#34;반갑습니다&#34;]
</span></code></pre></div>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-ac3992195bdfe2da845c2fc8c030e646">goland tips</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-12-05" class="text-muted">2019.12.05</time>
        
	</div>
	<p>cmd+ shift+ f =&gt; find in path (goland)</p>
<p>코드 어딧는지 찾기 딱좋다!</p>
<p>cmd + O =&gt; 기능 쫙 보는 찾기</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-6b0851710c0f814de79273292d4588ce">DDA 스터디</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-30" class="text-muted">2019.11.30</time>
        
	</div>
	<h1 id="dda-스터디">DDA 스터디</h1>
<h2 id="transaction">Transaction</h2>
<p>트랜잭션은은 여러 개의 읽기와 쓰기를 하나의 논리적인 유닛으로 묶는다.
-&gt; 그룹으로 묶은 오퍼레이션의 부분이 실패하면 전체가 실패한다.</p>
<p>safety guarantee (안정성 보장) =&gt; application 입장에서는 좋다.</p>
<p>=&gt; 이런 걸 보장 : ACID 보장해야함.</p>
<p><strong>Atomicity(원자성)</strong>
한 오퍼레이션이 더 작은 부분으로 쪼개지지 않는것. 디비에 쓰다가 반만 썼는데 &ldquo;성공&quot;하면 안되고, &ldquo;실패&quot;하고 마치 어떤 변화도 없었던 것처럼 유지해야함.</p>
<p><em>Consistency</em>
같은 데이터를 바라볼때 같은 값을 가지는 것. Consistensy를 실시간으로 만족시키는것은 퍼포먼스 적으로 힘들고, 그래서 eventual consistency같은 개념이 등장하는 것.</p>
<h3 id="isolation"><em>Isolation</em></h3>
<p><em>Serializability</em>
동시다발적인 요청이 들어오더라고 마치 serial한 요청이 들어온 것처럼 =&gt; 어려움.</p>
<dl>
<dt><em>Durability</em></dt>
<dd>커밋 success시엔 db crush가 나든 hardware fault가 나든 레코드를 잊아뿌면 안된다.</dd>
</dl>
<p>Single Node</p>
<ul>
<li>write-ahead log를 유지해서 폴트가 나도 복구할수있도록
Replicated database</li>
<li>몇개의 노드들에게 copy가 되야 함.</li>
</ul>
<p>Multi-object Transactions</p>
<ul>
<li>Violating atomicity example
: 메일 보내고, unread += 1 하는 경우 메일보내고 unread올릴라그랬는데 crash
메일은 보냈으나 상대방의 안읽음 +=1 을 못한경우 =&gt; 에러!
해결:  BEGIN TRANSACTION ~ END TRANSACTION</li>
</ul>
<h3 id="isolation-1">Isolation</h3>
<p>Weak Isolation 을 제공</p>
<p>So, 개발자가 주의해서 사용해야한다.</p>
<dl>
<dt>Dirty Write</dt>
<dd>row-level lock을 걸어야댐.
Dirty Read</dd>
<dd>갱신되지않는 데이터를 보이지 않게. 커밋된 데이터만 볼수있게.
Trasaction 이 완료되기전까지는 Previous만 보여주고 Transaction이 끝났을때 current를 보여준다.</dd>
</dl>
<p>snapshot isolation and repeatable read</p>
<p>앨리스 계좌 조회
1번 계좌 잔액 500원 -&gt; 600원
2번 계좌 잔액 500원 -&gt; 400원</p>
<p>할떄 순간적으로 500/400으로 조회되는 상황</p>
<p>일반적안 계좌조회 상황에서는 새로고침하면 문제가 안되지만, backup이나 anayltic 등에서는 큰 문제가 된다.(잘못된 데이터가 반영)</p>
<p>스냅샷 isolation 은 일반적으로 write lock을 사용한다.</p>
<h3 id="implementing-snapshot-isolation-using-multi-version-objects">Implementing snapshot isolation using multi-version objects</h3>
<p>history를 들구다닌다.</p>
<p>내 transaction id 보다 작은 값을 가진 history의 값을 가져가면된다.</p>
<p>update = delete + create</p>
<ol>
<li>In progress인 transaction 을 쫙 가져오고, 얘네들에 의한 변화는 쫙 무시.</li>
<li>Aborted trancation 에 의한 변화는 무시.</li>
<li>나보다 나중의 transaction 에 변화는 무시.</li>
<li>나보다 먼저지만, commit 되지않은거는 무시한다.</li>
</ol>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-b79aff5e78952dc2748e8e69b6628636">클로저를 고루틴으로 실행할때 주의할점.</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-30" class="text-muted">2019.11.30</time>
        
	</div>
	<p>go routine 만들 떄 익명함수로 할때 마지막 변수갑스로 다 써서 개망할뻔</p>
<blockquote>
<p>Closure(클로저)는 함수 바깥에 있는 변수를 참조하는 함수값을 일컫는다. 함수가 선언될 때의 환경을 계속 유지하여 프로그램의 흐름을 변수에 저장하기 위해 사용한다. 클로저는 함수형 언어의 큰 특징이며, Go 는 클로저를 통해 함수형 언어의 기능을 구현하고 있다.</p>
</blockquote>
<p>참고: <a href="http://pyrasis.com/book/GoForTheReallyImpatient/Unit25">http://pyrasis.com/book/GoForTheReallyImpatient/Unit25</a></p>
<h1 id="클로저를-고루틴으로-실행하기">클로저를 고루틴으로 실행하기</h1>
<p>반복문 내에 go routine를 삽입하여 concurrent한 Request를 날리는 로직을 작성하고 싶다고 하자.</p>
<p>처음엔 이런식으로 하면 될줄 알았다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>
 
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
    <span style="color:#4e9a06">&#34;fmt&#34;</span>
<span style="color:#000;font-weight:bold">)</span>
 
<span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">user</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;helloworld&#34;</span>
 
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">go</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/%v/%v&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic">// 반복문의 변수를 클로저에서 바로 사용
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}()</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><em>예상한 결과</em></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/1&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/2&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/3&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">...</span>
<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/99&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><em>실제 결과</em></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/100&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/100&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/100&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">...</span>
<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/100&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>그렇게 되는 이유는,</p>
<p>클로저를 고루틴으로 사용할때는 반복문이 끝난 뒤에 고루틴이 실행되기 때문이다. 따라서, 고루틴이 생성된 시점의 변수 i의 값은 100이다. 따라서 모두</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/helloworld/100&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>값으로 요청이 날라가게 되는것이다. 따라서 클로저를 고루틴으로 실행할때 반복문에 의해 바뀌는 변수는 반드시 파라미터로 넘겨줘야한다. 파라미터로 넘겨주는 시점에 해당 변수의 값이 복사되므로, 고루틴이 생성될때 그대로 사용할 수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>
 
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
    <span style="color:#4e9a06">&#34;fmt&#34;</span>
<span style="color:#000;font-weight:bold">)</span>
 
<span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">user</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;helloworld&#34;</span>
 
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">go</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n</span> <span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>          <span style="color:#8f5902;font-style:italic">// 익명 함수를 고루틴으로 실행(클로저)
</span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://post.naver.com/%v/%v&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">}(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span>                      <span style="color:#8f5902;font-style:italic">// 반복문의 변수는 매개변수로 넘겨줌
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-106c32897074f874669df46ca3978460">concurrency is not parallelism</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-28" class="text-muted">2019.11.28</time>
        
	</div>
	<p><a href="https://talks.golang.org/2012/concurrency.slide#1">https://talks.golang.org/2012/concurrency.slide#1</a></p>
<h1 id="concurrency">concurrency</h1>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-2e3cdd17f1d9860366f68fd26bb2ec6f">aws-lambda-in-go</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-25" class="text-muted">2019.11.25</time>
        
	</div>
	<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">Handler</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ctx</span> <span style="color:#000">context</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Context</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">error</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">file</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">os</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;config.json&#34;</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span><span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">err</span>
	<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#204a87;font-weight:bold">defer</span> <span style="color:#000">file</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Close</span><span style="color:#000;font-weight:bold">()</span>

	<span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Configuration</span><span style="color:#000;font-weight:bold">{}</span>
	<span style="color:#000">err</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">json</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewDecoder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">file</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Decode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">conf</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">err</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#8f5902;font-style:italic">// Initialize connection string
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">host</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">database</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Host</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">User</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Password</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Database</span>

	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">connectionString</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Sprintf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;host=%s user=%s password=%s dbname=%s&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">host</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">database</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#000">db</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">sql</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;postgres&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">connectionString</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">err</span>
	<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#204a87;font-weight:bold">defer</span> <span style="color:#000">db</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Close</span><span style="color:#000;font-weight:bold">()</span>

	<span style="color:#8f5902;font-style:italic">// TODO: 유저 프로파일 찌르기
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">rows</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">db</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Query</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;select * from experiments limit 5&#34;</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">err</span>
	<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#204a87;font-weight:bold">defer</span> <span style="color:#000">rows</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Close</span><span style="color:#000;font-weight:bold">()</span>

	<span style="color:#000">cols</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">rows</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Columns</span><span style="color:#000;font-weight:bold">()</span>

	<span style="color:#000">rowValues</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">make</span><span style="color:#000;font-weight:bold">([][]</span><span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{},</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#000">vals</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">make</span><span style="color:#000;font-weight:bold">([]</span><span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{},</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cols</span><span style="color:#000;font-weight:bold">))</span>

	<span style="color:#8f5902;font-style:italic">// pointer of interface
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">cols</span><span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">vals</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">rows</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Next</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">rowValue</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">make</span><span style="color:#000;font-weight:bold">([]</span><span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{},</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cols</span><span style="color:#000;font-weight:bold">))</span>
		<span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">rows</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Scan</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vals</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span>
		<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">err</span>
		<span style="color:#000;font-weight:bold">}</span>
		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">cols</span><span style="color:#000;font-weight:bold">{</span>
			<span style="color:#000">rowValue</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rowValue</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vals</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]).(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{}))</span>
		<span style="color:#000;font-weight:bold">}</span>

		<span style="color:#000">rowValues</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rowValues</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">rowValue</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">strings</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cols</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;,&#34;</span><span style="color:#000;font-weight:bold">))</span>
	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">rowValues</span><span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rowValues</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#8f5902;font-style:italic">// testcases
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// request에 있는걸로 / response 비교
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// 매번 connnection (1분 1번)
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// TODO: Close!
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// Request -&gt; user profile api
</span><span style="color:#8f5902;font-style:italic"></span>
	<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">nil</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><a href="https://www.calhoun.io/using-postgresql-with-go/">https://www.calhoun.io/using-postgresql-with-go/</a></p>
<p>// 매번 connnection (1분 1번)</p>
<blockquote>
<p><em>json.compact</em>
json을 비교하는데 똑같은 json이 자꾸 bytes.Compare 시에 다르다고 나와서 뭔가 했더니, 공백때문에 5개 byte가 더 길게 나왔다. 공백을 제거하기 위해 bytes.TrimSpace 이런거를 써도 JSON string 안에 공백이 있거나 하면 동작이 제대로 안된다. 오히려 데이터를 요상하게 만들 수 있으므로, JSON 내의 공백을 제거하거나 할때 json.Compact를 사용하도록 한다. buffer 를 만들고 해당 buffer에 공백을 제거할 json string을 넣는 방식으로 하면된다.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>

<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#4e9a06">&#34;bytes&#34;</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#4e9a06">&#34;fmt&#34;</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#4e9a06">&#34;encoding/json&#34;</span>

<span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">jsonb</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87">byte</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">`{
</span><span style="color:#4e9a06">        &#34;foo&#34;: &#34;bar&#34;
</span><span style="color:#4e9a06">    }`</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000">buffer</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bytes</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Buffer</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">json</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Compact</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">jsonb</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000;font-weight:bold">}</span>
	
	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><blockquote>
<p>Buffer 을 만들때
new(Buffer) (or just declaring a Buffer variable) is sufficient to initialize a Buffer</p>
</blockquote>
<p>위의 예시에서처럼 new(bytes.Buffer)를 하던지,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">buffer</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">bytes</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Buffer</span><span style="color:#000;font-weight:bold">{}</span>
</code></pre></div><p>이런식으로 생성한뒤 주소값을 넣어주면된다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">buffer</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">bytes</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Buffer</span>
</code></pre></div><p>이런식으로 빈 값을 가르키는 포인터만 만들면 메모리 참조 panic이 날수있으니 조심해야한다.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-27df5ade3010b14a6dd5ca2b3146b1f8">scripting in github action</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-22" class="text-muted">2019.11.22</time>
        
	</div>
	<h1 id="github-action">Github Action</h1>
<h2 id="cicd를-github-action-을-이용해서-구성해본다">CI/CD를 Github Action 을 이용해서 구성해본다</h2>
<blockquote>
<p>set -e
bash script를 짤때, 명령줄 한줄 한줄 넘어갈때 에러가 발생하면 발생한 line에서 바로 종료될수 있도록 check할 수 있는 기능이다. script가 종료될때까지 기다릴필요 없이 에러발생시 바로 종료되므로, 디버그 시에 좋을것이다.</p>
</blockquote>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-5b9d5d2318c342f6b5f9c03d26400563">ssh tunneling</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-22" class="text-muted">2019.11.22</time>
        
	</div>
	<h1 id="ssh-tunneling">ssh tunneling</h1>
<p>An SSH client connects to a Secure Shell server, which allows you to run terminal commands as if you were sitting in front of another computer. But an SSH client also allows you to “tunnel” a port between your local system and a remote SSH server.</p>
<p>There are three different types of SSH tunneling, and they’re all used for different purposes. Each involves using an SSH server to redirect traffic from one network port to another. The traffic is sent over the encrypted SSH connection, so it can’t be monitored or modified in transit.</p>
<p>You can do this with the ssh command included on Linux, macOS, and other UNIX-like operating systems. On Windows, which doesn’t include a built-in ssh command, we recommend the free tool PuTTY to connect to SSH servers. It supports SSH tunneling, too.</p>
<p>SSH client 는 Secure Shell Server에 접속해서 마치 다른 컴퓨터 앞에 앉아서 커맨드를 입력하듯이 만들어준다. 하지만 SSH client는 local 시스템과 remote ssh server와의</p>
<p><a href="https://www.howtogeek.com/168145/how-to-use-ssh-tunneling/">https://www.howtogeek.com/168145/how-to-use-ssh-tunneling/</a></p>
<p><a href="https://medium.com/serverlessguru/what-is-a-ssh-tunnel-aws-ec2-8ebc394b8208">https://medium.com/serverlessguru/what-is-a-ssh-tunnel-aws-ec2-8ebc394b8208</a></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh -N -L 5432:<span style="color:#ce5c00;font-weight:bold">{</span>remote_rds_url<span style="color:#ce5c00;font-weight:bold">}</span>:5432 ec2-user@<span style="color:#ce5c00;font-weight:bold">{</span>host<span style="color:#ce5c00;font-weight:bold">}</span> -i <span style="color:#ce5c00;font-weight:bold">{</span>pem-key<span style="color:#ce5c00;font-weight:bold">}</span>.pem
</code></pre></div>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-1b756cfc3b08669fde63190db6b73a87">aws-lambda</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-19" class="text-muted">2019.11.19</time>
        
	</div>
	<p>AWS lambda를 이용하여 serverless application을 생성할 수 있다. 다른말로, 백엔드 서버를 구축할 필요없이 핸들러 함수만 등록하면 Lambda가 해당 코드를 실행시켜주는 서비스이다. Trigger 시에만 코드를 실행하며 사용한 컴퓨팅 시간에 대해서만 요금을 지불할 수 있다. 다른 AWS 서비스와의 연동이 잘 되있고 이는 UI/cli 상으로 조정가능하다. 다만, Role, Network 설정을 잘 해주어야한다.</p>
<p><a href="https://aws.amazon.com/ko/lambda/">참고</a></p>
<p>실습해보기 위해 간단하게 vpc내 rds instance에 접근해서 간단한 쿼리를 날리는 핸들러를 파이썬으로 작성했다.</p>
<p>지원하는 언어별로 작업 방법이 다르고, 일단 Python을 기준으로 진행한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">create_conn</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">None</span>
    <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">psycopg2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conn_string</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">except</span> <span style="color:#000">psycopg2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DatabaseError</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">e</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span>
            <span style="color:#4e9a06">&#34;ERROR: Unexpected error: Could not connect to Postgres instance.&#34;</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exit</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;SUCCESS: Connection to RDS MySQL instance succeeded&#34;</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">conn</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">fetch</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conn</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">query</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Now executing: {}&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">query</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">cursor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">conn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cursor</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">execute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">query</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">raw</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fetchall</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">line</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">raw</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">line</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">lambda_handler</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">event</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">context</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">query_cmd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;SELECT * FROM PG_TABLES LIMIT 5&#34;</span>
    <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">query_cmd</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">create_conn</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">fetch</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conn</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">query_cmd</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">conn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">close</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span>
</code></pre></div><p>이때 Postgresql 에 접근하기 위한 드라이버로 psycopg2라는 외부 라이브러리를 import해주어야했기 때문에,
Lambda Runtime에 해당 라이브러리를 따로 첨부해주어야했다.</p>
<p>따로 첨부해주기 위해서는 소스코드 + 라이브러리 를 한꺼번에 압축하여 업로드하는 방법이 있고, layers라는 걸 활용해서 lambda function들이 사용할 외부 라이브러리를 그때그때 매번 업로드하지 않고 layer만 추가해서 사용할 수 있도록 해놓은 것도 있었는데, 한꺼번에 업로드하는것은 동작을 확인했고, layers를 실습해보고자 하였다.</p>
<ul>
<li><a href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/lambda-python-how-to-create-deployment-package.html">한꺼번에 압축하는 법</a></li>
</ul>
<p>Layers로 작업할때는 몇 가지만 주의하면 된다. 물론 이 몇가지 때문에 꽤 힘든 시간을 보내긴했다(ㅠㅠ)</p>
<ol>
<li>
<p>Lambda의 cpu 기준으로 컴파일된 라이브러리를 포함할것 (ex. _psycopg.cpython-36m-x86_64-linux-gnu.so)
<a href="https://github.com/jkehler/awslambda-psycopg2">람다용으로 컴파일된 라이브러리 레포지토리</a></p>
</li>
<li>
<p>python 폴더 밑에 라이브러리 폴더를 두고 python 폴더를 압축하여 업로드할것.</p>
</li>
</ol>
<ul>
<li><em>이 구조가 아니면 Lambda에서 import가 안된다!</em>(이것때문에 시간오래걸림)</li>
</ul>
<p>ex.</p>
<ul>
<li>python</li>
<li>
<ul>
<li>library1</li>
</ul>
</li>
<li>
<ul>
<li>library2</li>
</ul>
</li>
</ul>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-db4a5139db28ab728d63e5fb8dec0209">docker-compose up</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-14" class="text-muted">2019.11.14</time>
        
	</div>
	<p><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose#ports">큰 참고가 된 게시물</a></p>
<h1 id="개발환경-구성">개발환경 구성</h1>
<p>여러가지 다른 환경에 동일한 개발 환경을 구성할 수 있도록 하기 위해 Docker를 사용한다</p>
<h1 id="docker-compose-의-필요성">docker-compose 의 필요성</h1>
<p>Docker 로 개발환경을 구성할때 예를 들어 Web Application 과 Database 두 개의 서버를 띄워야한다고 하면,
일단 App을 하나의 컨테이너로 띄우고, Database를 또다른 컨테이너로 띄워서 둘이 통신할 수 있도록 해야한다.</p>
<p>그런데 컨테이너와 다른 컨테이너가 통신할 수 있게 하려면 docker run 에서 몇가지 옵션이 더 들어가야한다.</p>
<p>예시. Django application</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -it --rm <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p 8000:8000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    django-sample <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    ./manage.py runserver 0:8000
</code></pre></div><p>django 에서 사용할 데이터베이스 설정을 담은 settings.py 파일</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">DATABASES</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;default&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#39;ENGINE&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;django.db.backends.postgresql&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#39;NAME&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;sampleDatabase&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#39;USER&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;postgres&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#39;HOST&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;db&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#39;PORT&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;5432&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#39;PASSWORD&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;postgres&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>ex. Postgresql database</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name db <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">POSTGRES_DB</span><span style="color:#ce5c00;font-weight:bold">=</span>sampleDatabase <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">POSTGRES_USER</span><span style="color:#ce5c00;font-weight:bold">=</span>sampleuser <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">POSTGRES_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>samplesecret <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>	--volume<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>/docker/data:/var/lib/postgresql/data <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    postgres
</code></pre></div><blockquote>
<p>이렇게 환경변수를 설정해서 Postgresql 컨테이너를 실행시키면, default 값 대신 해당 값으로 초기화한다.
<a href="https://hub.docker.com/_/postgres">참고</a>. 예를 들어 default database 대신에 djangosample 이라는 database를 create한다. POSTGRES_DB의 경우에 정의되지 않으면 USER와 같은 이름의 database가 만들어진다. <em>단, 서로 다른 container가 통신을 해야하는 상황에서는 password는 반드시 필요하므로 설정해주어야한다</em></p>
</blockquote>
<p>단순하게 이렇게 구성해서는 두 컨테이너는 서로 통신할 수 없고,</p>
<blockquote>
<p>could not connect to server: Connection refused</p>
</blockquote>
<p>이 에러만 발생할 것이다.</p>
<p>이를 해결하기 위해선</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -it --rm <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p 8000:8000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --link db <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">DJANGO_DB_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>db <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">DJANGO_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span>True <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    django-sample <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    ./manage.py runserver 0:8000
</code></pre></div><p>이런식으로 &ndash;link 옵션을 통해 db 컨테이너와 app 컨테이너를 연결해줘야한다.</p>
<p>하지만, 이런식으로 하게 되면 조금 불편한 것이 사실이다. 이렇게 순차적으로 컨테이너를 실행시키는 것보단 한번 주루룩 설치하는 것이 아무래도 편할 것이다.</p>
<blockquote>
<p>게다가 link 옵션은 deprecate 예정이다.</p>
</blockquote>
<p>이를 위해서 docker-compose를 이용할 수 있다. 이름에서 떠오르는 composer 와 비슷하게 컨테이너의 관리도구 같은 느낌이다.
docker-compose.yml 파일을 이용하여 컨테이너 실행에 필요한 옵션을 기술할 수 있고, 컨테이너간 실행 순서나 의존성도 관리할 수 있다.</p>
<h2 id="docker-composeyml">docker-compose.yml</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">version: <span style="color:#4e9a06">&#34;3&#34;</span>

services:
  db:
    image: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data/
    environment:
      POSTGRES_DB: sampleDatabase
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
  web:
    build:
      context: .
      dockerfile: Dockerfile
    image: sampleApplication
    stdin_open: <span style="color:#204a87">true</span>
    tty: <span style="color:#204a87">true</span>
    command: &gt;
      bash -c <span style="color:#4e9a06">&#34;python manage.py migrate --noinput 
</span><span style="color:#4e9a06">      &amp;&amp; python manage.py createsu 
</span><span style="color:#4e9a06">      &amp;&amp; python manage.py collectstatic --noinput 
</span><span style="color:#4e9a06">      &amp;&amp; python manage.py runserver 0.0.0.0:8000&#34;</span>
    volumes:
      - .:/app
    ports:
      - <span style="color:#4e9a06">&#34;8000:8000&#34;</span>
    depends_on: <span style="color:#8f5902;font-style:italic"># depend_on 옵션을 주면 순서를 조정가능하다 (db가 올라간 후에 web이 올라가도록)</span>
      - db
    environment:
      DJANGO_SETTINGS_MODULE: sampleApplication.settings.default
</code></pre></div><p>위에 좀 복잡하게 했던걸 위와 같은 compose 파일을 작성하면 쉽게 동작시킬 수 있다.</p>
<p>compose 에서는 link같은 것 필요없이도, 서비스 끼리 이름으로 <strong>통신가능</strong>하다. 즉 위 예시에는 web에서 데이터베이스에 접근할때 단순히 다른 서비스인 db로 별다른 조치 없이 접근가능하다. Application 컨테이너가 뜰때 django의 settings.py에 database 설정의 host를 &lsquo;db&rsquo;로 해놓았기 때문에 이에 접근을 시도할 것이다. 예를 들어 settings.py 에 database host를 localhost라고 해놓았다면 접속이 안될것이다.</p>
<p>db라는 이름이 마음에 들지 않는다면 또는 compose 내에 &lsquo;links&rsquo;라는 옵션을 통해 db 외에 다른 이름을 alias시켜줄 수도 있다. mydatabase라던지&hellip;?</p>
<p>첨에 좀 헤맸던건, 자꾸 데이터베이스가 없다느니, role 이 존재하지 않는다느니 하는 문제였는데,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker volumn prune
docker ps -a // 도커 컨테이너 모두 조회<span style="color:#ce5c00;font-weight:bold">(</span>stop된것도<span style="color:#ce5c00;font-weight:bold">)</span>
rm -rf /var/lib/postgresql/data/

docker-compose down
</code></pre></div><p>컨테이너를 모두 조회해서 모두 삭제하고 마운트된 볼륨도 모두 삭제한 후 다시해보니 정상적으로 잘 작동했다.</p>
<p>기존 컨테이너와 뭔가가 충돌했던 모양이다.</p>
<p>이제 실행시켜보면 된다. &ndash;force-recreate옵션을 통해 무조건 컨테이너를 다시 만드는 옵션을 줄 수있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose up --force-recreate
</code></pre></div>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-854ed346fc46732b8d436bcd5617026d">rune ?</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-13" class="text-muted">2019.11.13</time>
        
	</div>
	<p>Go에서 String은 byte 들의 읽기전용 배열이라고 할 수 있다. 유니코드 표준은 값 하나에 의해 표현되는 항목에 대해 &ldquo;코드포인트&rdquo; 라는 용어를 사용한다. 16진수 2318값을 가진 코드 포인트 U+2318은 ⌘ 를 나타낸다. 좀 더 무난한 예제로, 유니코드 코드 포인트 U+0061은 소문자 &lsquo;a&rsquo;를 나타낸다.</p>
<p>일반적으로 글자는 여러 개 코드포인트의 조합으로 나타낼 수 있고, 따라서 이를 utf-8 인코딩한 바이트 배열로 나타낼 수 있다. 코드 포인트는 살짝 길기 때문에, Go에서는 <em>rune</em>이라는 용어를 사용한다. rune은 코드 포인트와 정확히 같은 개념이다. Go는 rune을 int32의 alias로 사용하여 프로그램이 이 integer 값이 특정 code point를 나타내는것이 명확하도록 하였다. 보통 character 상수라고 생각되는 것은 go 에서 rune 상수라고 불린다.</p>
<blockquote>
<p>&lsquo;⌘&rsquo;</p>
</blockquote>
<p>이 symbol의 타입과 값도 0x2318 integer 값을 가진 rune 타입이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>

<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
	<span style="color:#4e9a06">&#34;fmt&#34;</span>
<span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">test</span> <span style="color:#204a87;font-weight:bold">string</span>
	<span style="color:#000">test</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;</span>
	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;first test example:&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test</span><span style="color:#000;font-weight:bold">))</span>
	<span style="color:#000">test</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;a&#34;</span>
	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;second test example:&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test</span><span style="color:#000;font-weight:bold">))</span>
	<span style="color:#000">test</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;가&#34;</span>
	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;third test example:&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test</span><span style="color:#000;font-weight:bold">))</span>
	<span style="color:#8f5902;font-style:italic">// first test example: 3
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// second test example: 1
</span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// third test example: 3
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>string 타입의 변수 test가 있다고 했을때, 1 바이트로 표현할 수 있는 알파벳과 다르게 나머지 <em>글자</em> 들은 len을 출력했을때
일반적으로 예상하는 그 길이가 출력되지 않는다. 이는 각 character(알파벳 이외의 문자)가 1바이트 이상의 바이트로 표현되고, 이에 len을 출력했을때 바이트수가 출력되기 때문이다.</p>
<p>대신, 모든 글자(character)는 unicode의 특정 code point로 나타낼 수 있다. 이를 이용해서 한 글자당 한 rune 타입으로 바꿔서 string을 rune slice로 변환한다고 생각해보면, len을 출력했을때 원하는 출력을 얻을 수 있다. 즉, 아래와 같이 하면</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">runeTest</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87">rune</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;rune test example:&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">runeTest</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#8f5902;font-style:italic">// rune test example: 1
</span></code></pre></div><p>생각한 결과를 얻을 수 있다.</p>
<p><a href="joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">참고</a></p>
<h2 id="update">Update!!</h2>
<blockquote>
<blockquote>
<p>추가!</p>
</blockquote>
</blockquote>
<p>utf8 라이브러리의 아래 함수를 이용하면 utf8로 인코딩된 문자열 값의 길이를 알수있다. 예를 들어 한글은 1글자당 3바이트를 이용해 저장하므로, 그냥 len을 이용해 출력하면 3이지만 RuneCountInString함수를 이용하면 실제길이인 1을 구할수있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">han</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;한&#34;</span>
<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">han</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic">// 3
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">utf8</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">RuneCountInString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">han</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic">// 1
</span></code></pre></div><p><a href="http://pyrasis.com/book/GoForTheReallyImpatient/Unit45/02">utf8 패키지 내 함수 참고자료</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-67575c6ae03ca092937fd8f8f3c18a49">Django tutorial</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-11" class="text-muted">2019.11.11</time>
        
	</div>
	<h1 id="django">Django</h1>
<h2 id="setup">setup</h2>
<ol>
<li>가상환경 생성</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 -m venv VenvDjango
<span style="color:#204a87">cd</span> VenvDjango/ <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#204a87">source</span> bin/activate
</code></pre></div><ol start="2">
<li>프로젝트 디렉토리 파기</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir django-drf-react-quickstart <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#204a87">cd</span> <span style="color:#000">$_</span>
</code></pre></div><ol start="3">
<li>장고 &amp; 장고 rest framework 깔기, 프로젝트 시작</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install django djangorestframework
django-admin startproject project
</code></pre></div><h2 id="django-application-만들기">Django Application 만들기</h2>
<p>Django는 많은 Application<em>들</em> 로 구성되있다. 각 application은 이상적으로는 <em>한</em>가지 일만 해야한다. Django application 들은 모듈화되있고 재사용가능하다. Post를 작성하고 리스팅하는 application을 만들 수 있다. 다른 프로젝트가 같은 앱을 필요로하면 난 해당 앱을 패키지 매니저로 부터 설치하면된다.</p>
<p>이전에 만든 startproject 를 통해 project라는 폴더가 생성되 있었을텐데, 해당 폴더에 들어가서</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">django-admin startapp app_name
</code></pre></div><p>아래 명령어로 application 을 생성해주도록 한다. 여기선 app_name을 leads라고 하겠다.</p>
<p>그럼 프로젝트 구조는
django-drf-react-quickstart 아래</p>
<blockquote>
<ul>
<li>project
|&mdash; leads
|&mdash; project
|&mdash; manage.py</li>
</ul>
</blockquote>
<p>이 구조가 된다. 이때 project/settings.py에</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">INSTALLED_APPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;django.contrib.admin&#39;</span>,
    <span style="color:#4e9a06">&#39;django.contrib.auth&#39;</span>,
    <span style="color:#4e9a06">&#39;django.contrib.contenttypes&#39;</span>,
    <span style="color:#4e9a06">&#39;django.contrib.sessions&#39;</span>,
    <span style="color:#4e9a06">&#39;django.contrib.messages&#39;</span>,
    <span style="color:#4e9a06">&#39;django.contrib.staticfiles&#39;</span>,
    <span style="color:#4e9a06">&#39;leads&#39;</span>, <span style="color:#8f5902;font-style:italic"># 방금 생성한 app 을 추가한다</span>
	<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>이제 첫번째 모델을 추가해보자.</p>
<h2 id="django-model-만들기">Django Model 만들기</h2>
<p>첫번째 model을 만들 차례다. model은 테이블의 데이터를 표현하는 객체이다. 장고 뿐만 아니라 거의 모든 웹 프레임워크가 모델의 개념을 가지고 있다. 장고 모델은 1개 이상의 Field를 가지는데, Field는 테이블의 Column(열)을 의미한다.</p>
<p>예시 모델은 3개의 Field를 가진다고 해보자.</p>
<ul>
<li>name</li>
<li>email</li>
<li>message</li>
</ul>
<p>Django는 자동으로 created_at column을 추가해주지 않으므로 누락하지 않도록 한다.</p>
<p>leads/models.py를 열고 lead model을 작성한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django.db</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">models</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Lead</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CharField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">email</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">EmailField</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">message</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CharField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">300</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">created_at</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DateTimeField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">auto_now_add</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>cf. 모델 field에 대한 자세한 <a href="https://docs.djangoproject.com/en/2.0/ref/models/fields/">documentation</a>
Use-case에 가장 적합한 필드를 고르도록한다.</p>
<p>모델을 작성했으니, migration 을 만들어본다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python manage.py makemigrations leads
</code></pre></div><p>그리고 db에 migrate한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python manage.py migrate
</code></pre></div><h2 id="testing">Testing</h2>
<p>테스팅을 위해 아래 패키지를 설치한다</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install coverage
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">coverage run --source<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;.&#39;</span> manage.py <span style="color:#204a87">test</span>
// run converage
coverage html
// report 를 html 로 보고싶을때
coverage report
// <span style="color:#204a87">command</span> line에서 보고 싶을때
</code></pre></div><p>project/htmlcov/index.html을 browser에서 열어보면 뭘 테스트해야하는지 알수있을 것이다.</p>
<h2 id="rest-serializer">REST serializer</h2>
<p>serialization은 객체를 어떤 데이터 포맷으로 변형시키는 것이다. 그렇게 하면 파일로 저장하거나 네트워크를 통해 보낼 수 있는 형태가 된다. Django에서도, 모델이 Python class이고 이를 브라우저에서 렌더링하기 위해 JSON으로 바꿔야하기 때문에 Django REST Serializer가 필요하다. 이는 JSON을 객체로 바꾸는 데에도 적용된다.</p>
<p>./leads/serializer.py라는 파일을 만들고, 아래와 같이 작성한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rest_framework</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">serializers</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">leads.models</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Lead</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LeadSerializer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">serializers</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ModelSerializer</span><span style="color:#000;font-weight:bold">):</span>
	<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Meta</span><span style="color:#000;font-weight:bold">:</span>
		<span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Lead</span>
		<span style="color:#000">fields</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;id&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;email&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;message&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>field를 한땀한땀 작성하지 않고,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LeadSerializer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">serializers</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ModelSerializer</span><span style="color:#000;font-weight:bold">):</span>
	<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Meta</span><span style="color:#000;font-weight:bold">:</span>
		<span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Lead</span>
		<span style="color:#000">fields</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;__all__&#39;</span>
</code></pre></div><p>이렇게 작성할 수도 있다. 이제 Views/Urls를 살펴보자</p>
<h2 id="controller가아니고-views">Controller가&hellip;아니고 Views</h2>
<p>다른 프레임워크를 쓰다보면, Django에 Controller가 없다는 게 꽤 놀랍다. 보통 컨트롤러는 Request를 처리하고 Response를 내보내는 로직을 포함한다. 전통적인 MVC 아키텍쳐에서는 Model, View, Controller 세 개가 존재한다. Rails등이 있다. Django는 MVT 프레임워크인데, Model, View, Template이다. View가 Response/Request 라이프사이클을 관리한다. Django에는 Function View, Class based view, generic view 같이 다양한 종류의 View가 존재한다.</p>
<p>우리는 여기서 generic API views를 기준으로 실습을 진행한다.</p>
<ul>
<li>모델의 collection을 조회하고,</li>
<li>DB에 신규 객체들을 생성한다</li>
</ul>
<p>generics api 내에는 조회와 생성을 위한 view가 존재하는데, 아래와 같은 식으로 사용하면 된다
./leads/views.py 을 열고</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">leads.models</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Lead</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">leads.serializers</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">LeadSerializer</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rest_framework</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">generics</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LeadListCreate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">generics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ListCreateAPIView</span><span style="color:#000;font-weight:bold">):</span>
	<span style="color:#000">queryset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Lead</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">all</span><span style="color:#000;font-weight:bold">()</span>
	<span style="color:#000">serializer_class</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LeadSerializer</span>
</code></pre></div><p>3줄만 추가했는데, GET/POST request를 handling하는 view를 만들었다</p>
<h2 id="route가-아니고-urls">Route..가 아니고 urls</h2>
<p>Rails나 다른 프레임워크를 썼던 사람들은 Django에 Route 설정이 없다는 것에 꽤 놀랄 수 있다. View와 url을 mapping하는 가장 쉬운 방법은 url mapping이다.</p>
<p>위에서 만들었던 LeadListCreate를 api/lead/와 묶어보자. 즉, 모델 조회와 생성시에 api/lead/로 GET/POST 요청을 날리고 싶다.
URL mapping을 설정하기 위해서는 ./project/urls.py 을 연다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django.urls</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">path</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">include</span>

<span style="color:#000">urlpatterns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
	<span style="color:#000">path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">include</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;leads.urls&#39;</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>그리고 ./leads/urls.py로 가서</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django.urls</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">path</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">.</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">views</span>

<span style="color:#000">urlpatterns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
	<span style="color:#000">path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;api/lead/&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">views</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">LeadListCreate</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">as_view</span><span style="color:#000;font-weight:bold">()),</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>이렇게 작성해준다.</p>
<p>마지막으로 설정의 INSTALLED_APPS 에서 아래와 같이 rest_framework를 추가해주면,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">INSTALLED_APPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;django.contrib.admin&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.auth&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.contenttypes&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.sessions&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.messages&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.staticfiles&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;leads&#39;</span><span style="color:#000;font-weight:bold">,</span> 
    <span style="color:#4e9a06">&#39;rest_framework&#39;</span> <span style="color:#8f5902;font-style:italic"># enable rest framework</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python manage.py runserver
</code></pre></div><p><img src="https://www.valentinog.com/blog/wp-content/uploads/2018/02/django-rest-framework-browsable-api.png" alt=""></p>
<p>위 화면을 확인 가능하다.</p>
<h2 id="db-seeding">DB seeding</h2>
<p>Django fixture을 통해 DB에 데이터를 넣을 수 있다.
Fixture는 frontend 데이터를 가지고 데모할 때 유용하게 쓸수 있다.
./leads/fixtures 라는 폴더를 만들고 leads.json라는 파일을 아래와 같이 작성한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON"><span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;model&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;leads.lead&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;pk&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;fields&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Armin&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;email&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;something@gmail.com&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;message&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;I am looking for a Javascript mentor&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;created_at&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-14 00:00:00&#34;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;model&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;leads.lead&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;pk&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;fields&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Tom&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;email&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;tomsomething@gmail.com&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;message&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;I want to talk about a Python project&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;created_at&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-01-14 00:00:00&#34;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>저장한 후 fixture를 불러온다</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python manage.py loaddata leads
</code></pre></div><p>끝!</p>
<h2 id="react-frontend">React Frontend</h2>
<p>Django 와 React 를 어떻게 하면 잘 붙힐 수 있을까에 대해서는 여러가지 의견이 있다.</p>
<p>결과적으로는 얼마나 많은 Javascript가 필요한지에 따라 다르다. 보통은 3가지 패턴이 존재한다.</p>
<ol>
<li>React를 Django의 &ldquo;frontend&rdquo; app으로 가져간다: single HTML 템플릿을 load하고 React가 frontend를 관리하게 한다</li>
<li>Django를 독립적인 Rest API로 두고, React도 독립적인 SPA로 둔다 (인증을 위해 JWT가 필요하다)</li>
<li>섞는다: 작은 React app 들을 Django 템플릿안에 넣는다</li>
</ol>
<p>1번으로 가는 경우:</p>
<ul>
<li>app같은 웹사이트를 만들때</li>
<li>user interaction 이 많은 인터페이스일때</li>
<li>SEO 걱정이 없을때</li>
<li>react router가 괜찮을때</li>
</ul>
<p>React를 Django에 가깝게 유지하는 것은 인증이나 다른 것들을 쉽게 해준다. Django 빌트인 인증을 이용해서 사용자들의 등록이나 로그인을 만들 수 있고, 빌트인 Session 인증을 통해 토큰이나 JWT을 걱정하지 않을 수 있다.</p>
<p>3번으로 가는 경우:</p>
<ul>
<li>javascript 가 별로 필요없다</li>
<li>SEO를 신경써야한다</li>
</ul>
<h2 id="react-설정과-웹팩">React 설정과 웹팩</h2>
<p>1번으로 실습을 진행한다</p>
<p>Django와 React 조합의 장점은 API를 제공하는 Django Rest Framework이다. React는 &ldquo;frontend&quot;라는 개별적 app 으로 만들 것이다.</p>
<p>이전과 마찬가지로</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">django-admin startapp frontend
</code></pre></div><p>로 app을 만들어준다.</p>
<p>$HOME/django-drf-react-quickstart/project/ 밑에 frontend라는 디렉토리가 생겼을것이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p ./frontend/src/components
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p ./frontend/<span style="color:#ce5c00;font-weight:bold">{</span>static,templates<span style="color:#ce5c00;font-weight:bold">}</span>/frontend
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">cd</span> ..
// <span style="color:#000">$HOME</span>/django-drf-react-quickstart
npm init -y
// npm 환경 초기화
npm i webpack webpack-cli --save-dev
</code></pre></div><p>webpack과 webpack-cli를 설치한 후 package.json에 scripts를 아래와 같이 설정한다</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#4e9a06">&#34;scripts&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;dev&#34;</span>: <span style="color:#4e9a06">&#34;webpack --mode development ./project/frontend/src/index.js --output ./project/frontend/static/frontend/main.js&#34;</span>,
  <span style="color:#4e9a06">&#34;build&#34;</span>: <span style="color:#4e9a06">&#34;webpack --mode production ./project/frontend/src/index.js --output ./project/frontend/static/frontend/main.js&#34;</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>그리고 코드 트랜스파일을 위해 babel을 설치한다</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm i @babel/core babel-loader @babel/preset-env @babel/preset-react babel-plugin-transform-class-properties --save-dev
</code></pre></div><p>babel-plugin-transform-class-properties 는 ES6 클래스 static property를 사용하기 위해 필수적이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm i react react-dom prop-types --save-dev
</code></pre></div><p>React와 prop-type도 설치한다</p>
<p>프로젝트 폴더내에 .babelrc 라는 새로운 파일을 만들어 babel 을 설정해준다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;presets&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;@babel/preset-env&#34;</span>, <span style="color:#4e9a06">&#34;@babel/preset-react&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">]</span>,
    <span style="color:#4e9a06">&#34;plugins&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;transform-class-properties&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>마지막으로 webpack.config.js라는 파일을 작성하여 babel-loader를 설정해준다</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">module.exports <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{</span>
  module: <span style="color:#ce5c00;font-weight:bold">{</span>
    rules: <span style="color:#ce5c00;font-weight:bold">[</span>
      <span style="color:#ce5c00;font-weight:bold">{</span>
        test: /<span style="color:#4e9a06">\.</span>js$/,
        exclude: /node_modules/,
        use: <span style="color:#ce5c00;font-weight:bold">{</span>
          loader: <span style="color:#4e9a06">&#34;babel-loader&#34;</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>
      <span style="color:#ce5c00;font-weight:bold">}</span>
    <span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</code></pre></div><p>셋팅 끝!</p>
<h2 id="react-frontend-1">React Frontend</h2>
<p>./frontend/views.py를 작성한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django.shortcuts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">render</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">index</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">):</span>
	<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">render</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;frontend/index.html&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>./frontend/templates/frontend/index.html을 작성한다</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#8f5902;font-style:italic">&lt;!DOCTYPE html&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">meta</span> <span style="color:#c4a000">charset</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;utf-8&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">meta</span> <span style="color:#c4a000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;viewport&#34;</span> <span style="color:#c4a000">content</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;width=device-width, initial-scale=1&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">link</span> <span style="color:#c4a000">rel</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;stylesheet&#34;</span> <span style="color:#c4a000">href</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>Django DRF - React : Quickstart - Valentino G. - www.valentinog.com<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">section</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;section&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
    <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">div</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;container&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
          <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">div</span> <span style="color:#c4a000">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;app&#34;</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;columns&#34;</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#8f5902;font-style:italic">&lt;!-- React --&gt;</span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">div</span><span style="color:#000;font-weight:bold">&gt;</span>
    <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">div</span><span style="color:#000;font-weight:bold">&gt;</span>
  <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">section</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span>
</code></pre></div><p>마지막에서 frontend/main.js를 호출한다</p>
<p>./project/urls.py를 열고</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">urlpatterns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000">path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">include</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;leads.urls&#39;</span><span style="color:#000;font-weight:bold">)),</span>
    <span style="color:#000">path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">include</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;frontend.urls&#39;</span><span style="color:#000;font-weight:bold">)),</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>frontend.urls를 포함해준다</p>
<p>./frontend/urls.py를 열고</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django.urls</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">path</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">.</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">views</span>
<span style="color:#000">urlpatterns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000">path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">views</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">index</span> <span style="color:#000;font-weight:bold">),</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>view를 연결해준다.</p>
<p>./project/settings.py를 열고 installed_app에 frontend를 추가해준다</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">INSTALLED_APPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;django.contrib.admin&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.auth&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.contenttypes&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.sessions&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.messages&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;django.contrib.staticfiles&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;leads&#39;</span><span style="color:#000;font-weight:bold">,</span> 
    <span style="color:#4e9a06">&#39;rest_framework&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;frontend&#39;</span> <span style="color:#8f5902;font-style:italic"># enable the frontend app</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>지금 서버를 실행시켜보면</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python manage.py runserver
</code></pre></div><p>아무것도 안뜬다. React가 없기 떄문.</p>
<p>React frontend를 만들기 위해서 3개의 컴포넌트가 필요한데,</p>
<ol>
<li>Mother Component인 App</li>
<li>data fetching을 위한 stateful component인 Dataprovider</li>
<li>데이터 display를 위한 stateless component 인 Table</li>
</ol>
<h3 id="app">App</h3>
<div id="app"> </div> 에 react를 붙히기 위한 메인 컴포넌트이다.
./frontend/src/components/App.js라는 파일을 만든다.
```python
import React from "react";
import ReactDOM from "react-dom";
import DataProvider from "./DataProvider";
import Table from "./Table";
const App = () => (
  <DataProvider endpoint="api/lead/" 
                render={data => <Table data={data} />} />
);
const wrapper = document.getElementById("app");
wrapper ? ReactDOM.render(<App />, wrapper) : null;
```

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-8bdfe4098c42101747264a2bec233bd7">reflect 어떻게 쓰지 - 2</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-07" class="text-muted">2019.11.07</time>
        
	</div>
	<p>Reflect를 사용해서 좀 더 복잡한 로직을 수행하는 예제이다.
예를 들어 API 서버의 들어오는 Request와 나가는 Response 를 모두 서버에 로그로 남겨두는 경우,
해당 Request와 Response 의 특정 필드는 개인정보에 해당하므로 비식별화한 후 저장하도록 하게 하고싶다고 한다.
그리고 이때 Request 와 Response는 모두 JSON 으로 주고 받는다.</p>
<ul>
<li>앱로그</li>
<li>트랜잭션로그</li>
</ul>
<p>재사용 가능한 middleware/transaction.go</p>
<p>개선사항</p>
<ol>
<li>data 가 포인터이든, 값이든 대응 할 수 있도록 type 검사를 수행하고, map[string]string을 대신에 기존 data의 타입을 복사해서 새로운 변수를 만든다. reflect.New를 이용하여 파라미터로 넘어온 특정 타입의 변수를 만들수 있다. 단, 포인터로 만들어지므로 주의해서 쓰도록 한다.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TypeOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Kind</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Ptr</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">buffdata</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">New</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TypeOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Elem</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#000">Interface</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">buffdata</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">New</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TypeOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)).</span><span style="color:#000">Interface</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>buffdata 라는 data와 같은 타입의 변수를 만들었으니 해당 변수에 copy한다. copier라는 라이브러리를 사용하였고 struct에서 struct로 복사할 수 있게 해주는 라이브러리이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">copier</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Copy</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">buffdata</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">log</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Fail to copy data for response log&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><ol start="2">
<li>로그를 남기는 것은 async로 처리하여, 속도를 높힌다
ShouldBindJson는 Request를 특정 struct로 binding 하기 위해 사용하는 것인데, 이를 Wrapping하여 Request 로그를 남기는 로직을 추가한 것이므로, 뒤에 로직같은 경우엔 비동기로 처리하는 것이 좋다.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">wg</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">go</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(){</span>
	<span style="color:#204a87;font-weight:bold">defer</span> <span style="color:#000">wg</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Done</span><span style="color:#000;font-weight:bold">()</span>
	<span style="color:#000">deidentify</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ValueOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">buffdata</span><span style="color:#000;font-weight:bold">))</span>
	
	<span style="color:#000">headers</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">json</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Marshal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Request</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Header</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000">body</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">json</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Marshal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">buffdata</span><span style="color:#000;font-weight:bold">)</span>
	
	<span style="color:#000">log</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Transaction</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">log</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TransactionLog</span><span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">Type</span><span style="color:#000;font-weight:bold">:</span>    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">LogTypeRequest</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">URL</span><span style="color:#000;font-weight:bold">:</span>     <span style="color:#000">c</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Request</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">URL</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">(),</span>
		<span style="color:#000">Method</span><span style="color:#000;font-weight:bold">:</span>  <span style="color:#000">c</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Request</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Method</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">Headers</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">headers</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">Body</span><span style="color:#000;font-weight:bold">:</span>    <span style="color:#000">body</span><span style="color:#000;font-weight:bold">})</span>
<span style="color:#000;font-weight:bold">}()</span>
<span style="color:#000">wg</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Wait</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><ol start="3">
<li>비식별화 로직 한 함수에 정리하여 비식별화 로직과 request/response 처리 로직 분리</li>
</ol>
<p>=&gt; 이전 비식별화 + request 처리 혼재 / 비식별화 + response 처리 혼재</p>
<ul>
<li>
<p>Parameter가 포인터이면 안되는 함수
=&gt; 해당 value 종류가 reflect.Ptr / reflect.Interface 이면 Elem() 처리</p>
</li>
<li>
<p>Nested Struct JSON을 처리할때 DeepFields, DeepTag를 이용해서 Field와 Tag를 각각 모두 뽑아내어 처리하기
=&gt; 비식별화 함수 로직 자체를 깔끔하게 해서 한 함수 내에서 처리</p>
</li>
</ul>
<p><em>Old</em></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">DeepFields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">iface</span> <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Value</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">fields</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">make</span><span style="color:#000;font-weight:bold">([]</span><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000">ifaceValue</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ValueOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">iface</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000">ifaceType</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TypeOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">iface</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#000">ifaceType</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NumField</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">ifaceValue</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span>
		<span style="color:#204a87;font-weight:bold">switch</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Kind</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">case</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Struct</span><span style="color:#000;font-weight:bold">:</span>
			<span style="color:#000">fields</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fields</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DeepFields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Interface</span><span style="color:#000;font-weight:bold">())</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span>
		<span style="color:#204a87;font-weight:bold">default</span><span style="color:#000;font-weight:bold">:</span>
			<span style="color:#000">fields</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fields</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">)</span>
		<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">fields</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><em>NEW</em></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">deidentify</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Kind</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Ptr</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Kind</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Interface</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">v</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Elem</span><span style="color:#000;font-weight:bold">()</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#204a87;font-weight:bold">switch</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Kind</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">case</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Slice</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Array</span><span style="color:#000;font-weight:bold">:</span>
		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">idx</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Len</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#000">deidentify</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Index</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">))</span>
		<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#204a87;font-weight:bold">case</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Struct</span><span style="color:#000;font-weight:bold">:</span>
		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">idx</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">NumField</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Tag</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;deidentify&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;true&#34;</span> <span style="color:#000;font-weight:bold">{</span>
				<span style="color:#000">mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">))</span>
			<span style="color:#000;font-weight:bold">}</span>
			<span style="color:#000">deidentify</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">))</span>
		<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">switch</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Kind</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">case</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">:</span>
		<span style="color:#000">values</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87">rune</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">())</span>

		<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">result</span> <span style="color:#204a87;font-weight:bold">string</span>
		
		<span style="color:#000">masked</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">make</span><span style="color:#000;font-weight:bold">([]</span><span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">values</span><span style="color:#000;font-weight:bold">))</span>
		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">idx</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">masked</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#000">masked</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;*&#34;</span>
		<span style="color:#000;font-weight:bold">}</span>

		<span style="color:#000">v</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">strings</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">masked</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">))</span>
	<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><blockquote>
<p>Rune을 쓰는 이유!</p>
</blockquote>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-d53c72cb81c4e15423fcac286eacb365">reflect 어떻게 쓰지 - 1</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-11-06" class="text-muted">2019.11.06</time>
        
	</div>
	<p>Reflect을 가장 먼저 접하게 된것은 작년이었는데 그때 당시엔 그냥 대충 써보다가 어려워서 기존에 사용했었던 코드들에서도 다 reflect를 빼버렸었다. 당장 급했는데 자꾸 뭐시기 뭐시기 나오네 이러고 별로 이해하려는 노력 없이 사용했었기 때문이었던 것같다.</p>
<p>그러다 다시 go를 쓰게 되서 코딩을 하다가 또 reflect를 사용해야하는 경우를 발견했는데,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">sampleJSON</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">Num</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;NUM&#34; joyful:&#34;true&#34;`</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>뭐 이런식으로 되어있다고 할때, json struct field의 tag를 받아오고 싶을 때 어떻게 할지를 찾아보다가 reflect를 사용하게 되면 쉽게 가능하다는 걸 알게 되었다.</p>
<p>일단 잠시 reflect 맛을 보기 위해 예제를 수행해보자</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#8f5902;font-style:italic">// 예를 들어 sj라는 이름의 sample Json struct가 있다고 하자
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">sj</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">sampleJSON</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;01000000000&#34;</span><span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ValueOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sj</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">())</span>
<span style="color:#8f5902;font-style:italic">// 1. reflect.ValueOf(interface) 해당 인터페이스의 reflect.Value값이 나온다
</span><span style="color:#8f5902;font-style:italic">// 2. 거기서 Type()을 호출하면 해당 변수의 타입이 나온다. 여기선 sampleJSON
</span><span style="color:#8f5902;font-style:italic">// 3. 해당 타입의 Kind()를 조회해보면 구조체이므로 reflect.Struct이다
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ValueOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sj</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Kind</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Struct</span><span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;say hello to struct&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>즉 reflect는 특정 interface 값의 Value를 조회할 수 있도록한다. 이 Value를 가지고 여러가지를 해볼 수 있는데 이는 추후에 하도록 하고, 일단 이 Value에 Type()을 조회하면 해당 변수의 값이 아닌 sampleJson 구조체 타입 자체의 정보를 다룰수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ValueOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sj</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#8f5902;font-style:italic">// main.sampleJSON
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TypeOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sj</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">// main.sampleJSON
</span></code></pre></div><p>또한 위 두 줄은 같은 역할을 수행하므로 밑에 TypeOf를 사용해도 무방하다.</p>
<p>이제 Json tag를 본격적으로 찾아보려면,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">structTag</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TypeOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sj</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Tag</span>
<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">structTag</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">// json:&#34;NUM&#34; joyful:&#34;true&#34;
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">structTag</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;joyful&#34;</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#8f5902;font-style:italic">// true
</span></code></pre></div><p>위와 같이 하면 되는데, tag는 reflect.StructField 에 저장되있는 속성이므로 TypeOf으로 타입을 조회한 후, Field(특정 필드를 선택)로 StructField 를 받아오면된다. 또한 특정 태그만 받아오고 싶을시 Get을 통해 특정태그만 받아올 수도 있다.</p>
<p>주의할 점은 위에서 설명한건 reflect.ValueOf 또는 TypeOf의 파라미터로 들어온 interface타입이 값일때를 말한다는 것이다. 만약 포인터값일때는</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">reflect</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TypeOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">sj</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Elem</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Tag</span>
</code></pre></div><p>이런식으로 Elem()을 추가해주도록한다. 따라서 요기능을 넣는 함수들에는 해당 값이 값인지 포인터인지 판단하는 로직이 들어가야한다.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-4cb1018c33a47db3bc3d07ddce484bf4">언니가 사준 맥 립스틱 색깔</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-19" class="text-muted">2019.10.19</time>
        
	</div>
	<p>MAC</p>
<p>&ldquo;LUSTRE LIPSTICK ROUGE A LEVRE&rdquo;</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-2ba4924ed323a7f7575d27a5347cb5ff">How to study GOlang</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-16" class="text-muted">2019.10.16</time>
        
	</div>
	<p><a href="https://golangexample.com/">https://golangexample.com/</a></p>
<p><a href="https://levelup.gitconnected.com/crud-restful-api-with-go-gorm-jwt-postgres-mysql-and-testing-460a85ab7121">https://levelup.gitconnected.com/crud-restful-api-with-go-gorm-jwt-postgres-mysql-and-testing-460a85ab7121</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-e0452db584ade6c5afb908229e686e8b">리뷰해보고 싶은 Gin Boilerplate</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-16" class="text-muted">2019.10.16</time>
        
	</div>
	<p><a href="https://github.com/yakuter/ugin">https://github.com/yakuter/ugin</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-f378d86b2613e0fa3334030ba313b7fb">Dataproc</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-15" class="text-muted">2019.10.15</time>
        
	</div>
	<p>Dataproc</p>
<p>Overview</p>
<p>Cloud Dataproc은 spark이나 하둡 클러스터를 더 쉽고 효율적으로 운영하기 위한 빠르고, 쓰기 쉬운, 완전 관리형 클라우드 서비스이다. 몇 시간이나 며칠 걸리는 운영 작업 대신에 Cloud Dataproc을 만들어서, 데이터 파이프라인을 위한 클러스터 증설등의 걱정을 없앨 수 있습니다.
이 실험은 GCP 콘솔을 이용해서 구글 클라우드 Dataproc cluster를 만들고, 해당 클러스터에서 간단한 아파치 스팤 잡을 수행하고, 클러스터 내에서 워커의 수를 수정하는 예제입니다.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-433f8ffea0d4a2ddbdbae09c58e69202">Dataproc</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-15" class="text-muted">2019.10.15</time>
        
	</div>
	<p><a href="https://google.qwiklabs.com/focuses/672?parent=catalog">https://google.qwiklabs.com/focuses/672?parent=catalog</a></p>
<p>Introduction
Cloud Dataproc is a managed Spark and Hadoop service that lets you take advantage of open source data tools for batch processing, querying, streaming, and machine learning. Cloud Dataproc automation helps you create clusters quickly, manage them easily, and save money by turning clusters off when you don&rsquo;t need them. With less time and money spent on administration, you can focus on your jobs and your data.</p>
<p>Consider using Cloud Dataproc to scale out compute-intensive jobs that meet these characteristics:</p>
<p>The job is <strong>embarrassingly parallel</strong>—in other words, you can process different subsets of the data on different machines.
You already have Apache Spark code that does the computation or you are familiar with Apache Spark.
The distribution of the work is pretty uniform across your data subsets.
If different subsets require different amounts of processing (or if you don&rsquo;t already know Apache Spark), Apache Beam on Cloud Dataflow is a compelling alternative because it provides autoscaling data pipelines.</p>
<p>In this lab, the job that you will run outlines the faces in the image using a set of image processing rules specified in OpenCV. The Vision API is a better way to do this, since these sort of hand-coded rules don&rsquo;t work all that well, but this lab is an example of doing a compute-intensive job in a distributed way.</p>
<p>Setup</p>
<p>Install Software
Now we&rsquo;ll set up the software to run the job. Using sbt, an open source build tool, you&rsquo;ll build the JAR for the job you&rsquo;ll submit to the Cloud Dataproc cluster. This JAR will contain the program and the required packages necessary to run the job. The job will detect faces in a set of image files stored in a Google Cloud Storage (GCS) bucket, and write out image files with the faces outlined, to either the same or to another Cloud Storage bucket.</p>
<p>Create a Cloud Dataproc cluster
Step 1
Run the following commands in the SSH window to name your cluster and to set the MYCLUSTER variable. You&rsquo;ll be using the variable in commands to refer to your cluster:</p>
<p>MYCLUSTER=&quot;${USER/_/-}-qwiklab&quot;
echo MYCLUSTER=${MYCLUSTER}
Step 2
Set a default GCE zone to use (preferably the one you used for your development machine) and create a new cluster:</p>
<p>gcloud config set compute/zone us-central1-a
gcloud dataproc clusters create ${MYCLUSTER} &ndash;worker-machine-type=n1-standard-2 &ndash;master-machine-type=n1-standard-2
This might take a couple minutes. The default cluster settings, which include two worker nodes, should be sufficient for this lab. n1-standard-2 is specified as both the worker and master machine type to reduce the overall number of cores used by the cluster.</p>
<p>See the Cloud SDK gcloud dataproc clusters create command for information on using command line flags to customize cluster settings.
Submit your job to Cloud Dataproc
In this lab the program you&rsquo;re running is used as a face detector, so the inputted haar classifier must describe a face. A haar classifier is an XML file that is used to describe features that the program will detect. You will download the haar classifier file and include its GCS path in the first argument when you submit your job to your Cloud Dataproc cluster.</p>
<p>Step 1
Run the following command in the SSH window to load the face detection configuration file into your bucket:</p>
<p>curl <a href="https://raw.githubusercontent.com/opencv/opencv/master/data/haarcascades/haarcascade_frontalface_default.xml">https://raw.githubusercontent.com/opencv/opencv/master/data/haarcascades/haarcascade_frontalface_default.xml</a> | gsutil cp - gs://${MYBUCKET}/haarcascade_frontalface_default.xml
Step 2
Use the set of images you uploaded into the imgs directory in your GCS bucket as input to your Feature Detector. You must include the path to that directory as the second argument of your job-submission command.</p>
<p>Submit your job to Cloud Dataproc:</p>
<p>cd ~/cloud-dataproc/codelabs/opencv-haarcascade
gcloud dataproc jobs submit spark<br>
&ndash;cluster ${MYCLUSTER}<br>
&ndash;jar target/scala-2.10/feature_detector-assembly-1.0.jar &ndash;<br>
gs://${MYBUCKET}/haarcascade_frontalface_default.xml<br>
gs://${MYBUCKET}/imgs/<br>
gs://${MYBUCKET}/out/
You can add any other images to use to the GCS bucket specified in the second argument.</p>
<p>Step 3
Monitor the job, in the Console go to Navigation menu &gt; Dataproc &gt; Jobs. Move on to the next step when you get a similar output:</p>
<p>job-complete.png</p>
<p>Step 4
When the job is complete, go to Navigation menu &gt; Storage and find the bucket you created (it will have your username followed by student-image followed by a random number) and click on it. Then click on an image in the Out directory. The image will download to your computer.</p>
<p>How accurate is the face detection? The Vision API is a better way to do this, since this sort of hand-coded rules don&rsquo;t work all that well. You can see how it works next.</p>
<p>Step 5 (Optional)
Go back to the imgs folder and click on the other images you uploaded to your bucket. This will download the three sample images. Save them to your computer.</p>
<p>Navigate to the Vision API page, scroll down to the Try the API section and upload the images you downloaded from your bucket. You&rsquo;ll see the results of the image detection in seconds. The underlying machine learning models keep improving, so your results may not be the same:</p>
<p>result1.png result2.png result3.png</p>
<p>Step 6 (Optional)
If you want to experiment with improving the Feature Detector, you can make edits to the FeatureDetector code, then rerun sbt assembly and the gcloud dataproc and jobs submit commands.</p>
<p>Congratulations!
You learned how to spin up a Cloud Dataproc cluster and run jobs!</p>
<p>Data_Science_125_2.png</p>
<p>Finish Your Quest
This self-paced lab is part of the Qwiklabs Quest Scientific Data Processing. A Quest is a series of related labs that form a learning path. Completing this Quest earns you the badge above, to recognize your achievement. You can make your badge (or badges) public and link to them in your online resume or social media account. Enroll in this Quest and get immediate completion credit if you&rsquo;ve taken this lab. See other available Qwiklabs Quests.</p>
<p>Take Your Next Lab
Continue your Quest with Distributed Computation of NDVI from Landsat Images using Cloud Dataflow, or try one of these:</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-5b7cccb8a01fb35797a2e436cba41ed8">VPC and NAT</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-15" class="text-muted">2019.10.15</time>
        
	</div>
	<p>Data ingestion from server</p>
<p>Stackdriver</p>
<ul>
<li>로깅</li>
<li>모니터링</li>
</ul>
<p>vs elastic search (+kibana)</p>
<p>비용절감.</p>
<p>워크샵에서는 qwiklab이라는 시스템을 이용해서 실습을 진행한다. 실습용 profile을 받고, 해당 profile의 cloud console에 접속하여 진행하기 때문에 해당 실습이 종료되면 profile 삭제등으로 크레딧이 청구될 일이 없다는 장점이 있다. 실제로 다른 워크샵에서는 리소스를 깨끗히 정리하지 못해서 비용이 청구되는 일이 굉장히 많은데, 이 부분을 깔끔히 해결했다.</p>
<p>이 예제에서는 쿠버네티스 엔진 클러스터를 만들고, 간단한 샘플 어플리케이션을 배포한다. 기본적으로 GCP의 쿠버네티스 엔진 클러스터는 Terraform 을 이용해서 일단 application을 Kubernetes cluster에 배포한다.</p>
<blockquote>
<p><em>Note</em>: Terraform이란 무엇?</p>
<ul>
<li>테라폼은 오픈소스 인프라 스트럭처 관리 도구이다. Chef나 Ansible과 같은 Provisoning
세 가지의 terraform 파일을 사용하는데, main.tf, provider.tf, variables.tf 이다. Terraform은 특정 디렉토리의 모든 tf 확장자 파일을 읽어들여 리소스 생성/수정/삭제를 진행하므로,
어떤식으로 tf 파일을 작성할지에 대해서 제한은 없지만, 이 튜토리얼에서는 3개로 나눠서 진행하였다. 먼저, provider.tf는 이름에서도 알수 있듯이,</li>
</ul>
</blockquote>
<p>For instance, Terraform can build out GCP projects and compute instances, etc., even set up a Kubernetes Engine cluster and deploy applications to it. When requirements change, the descriptor can be updated and Terraform will adjust the cloud infrastructure accordingly.
예를 들어, 테라폼은</p>
<hr>
<p>Deployment
Following the principles of Infrastructure as Code and Immutable Infrastructure, Terraform supports the writing of declarative descriptions of the desired state of infrastructure. When the descriptor is applied, Terraform uses GCP APIs to provision and update resources to match. Terraform compares the desired state with the current state so incremental changes can be made without deleting everything and starting over. For instance, Terraform can build out GCP projects and compute instances, etc., even set up a Kubernetes Engine cluster and deploy applications to it. When requirements change, the descriptor can be updated and Terraform will adjust the cloud infrastructure accordingly.</p>
<p>This example will start up a Kubernetes Engine cluster and deploy a simple sample application to it. By default, Kubernetes Engine clusters in GCP are provisioned with a pre-configured Fluentd-based collector that forwards logs to Stackdriver. Interacting with the sample app will produce logs that are visible in the Stackdriver Logging and other log event sinks.</p>
<p>Update the provider.tf file
Remove the provider version for the Terraform from the provider.tf script file.</p>
<p>Edit the provider.tf script file.</p>
<p>nano ~/gke-logging-sinks-demo/terraform/provider.tf</p>
<p>If the file contains static version string for the google provider as given below then remove it.</p>
<p>&hellip;.
provider &ldquo;google&rdquo; {
project = var.project
version = &ldquo;~&gt; 2.10.0&rdquo;
}</p>
<p>After modification your provider.tf script file should look like:</p>
<p>&hellip;
provider &ldquo;google&rdquo; {
project = var.project
}</p>
<p>Save the file.</p>
<p>Deploying the cluster
There are three Terraform files provided with this lab example. The first one, main.tf, is the starting point for Terraform. It describes the features that will be used, the resources that will be manipulated, and the outputs that will result. The second file is provider.tf, which indicates which cloud provider and version will be the target of the Terraform commands&ndash;in this case GCP.</p>
<p>The final file is variables.tf, which contains a list of variables that are used as inputs into Terraform. Any variables referenced in the main.tf that do not have defaults configured in variables.tf will result in prompts to the user at runtime.</p>
<p>To build out the environment you can execute the following make command:</p>
<p>make create</p>
<p>Note: If you get deprecation warnings related to the zone varibale, please ignore it and move forward in the lab.
Test Completed Task
Click Check my progress to verify your performed task. If you have successfully deployed necessary infrastructure with Terraform, you will see an assessment score.</p>
<p>Use Terraform to set up the necessary infrastructure
Validation
If no errors are displayed during deployment, after a few minutes you should see your Kubernetes Engine cluster in the GCP Console.</p>
<p>Go to Navigation menu &gt; Kubernetes Engine &gt; Clusters to see the cluster with the sample application deployed.</p>
<p>To validate that the demo deployed correctly, run:</p>
<p>make validate</p>
<p>Your output will look like this:</p>
<p>make_valid.png</p>
<p>Now that the application is deployed to Kubernetes Engine you can generate log data and use Stackdriver and other tools to view it.</p>
<p>어플리케이션은 쿠버네티스 엔진 위에 배포되기 때문에 로그 데이터를 생성하고 스택드라이버나 다른 툴을 사용해서 조회할 수 있다.</p>
<p>콘솔에서 Networking section -&gt; Network services로 가면 기본 TCP LB 가 셋업되있다. LB 상세보기를 선택하면 Frontend라고 써있고 IP 주소가 나와있다. 해당 주소를 복사해서 브라우저에 붙여넣어보면, 아까 테라폼으로 띄웠던 샘플 어플리케이션이 나온다. 브라우저에서 어플리케이션을 열때마다, Stackdriver logging에 로그 이벤트 들을 publish한다. 몇번 리프레쉬를 해줘서, 로그를 조금 쌓아주도록 하자.</p>
<p>Logs in Stackdriver
Stackdriver provides a UI for viewing log events. Basic search and filtering features are provided, which can be useful when debugging system issues. The Stackdriver Logging is best suited to exploring more recent log events. Users requiring longer-term storage of log events should consider some of the tools you&rsquo;ll explore in the following sections.</p>
<p>To access the Stackdriver Logging console perform the following steps:</p>
<p>In the GCP Console, from the Navigation menu, in the Stackdriver section, click on Logging.
On this page change the Audited Resource filter to Kubernetes Container &gt; stackdriver-logging &gt; default. stackdriver-logging is the cluster; and default is the namespace).
Stack_clustername_default.png</p>
<p>On this screen, you can expand the bulleted log items to view more details about a log entry.
Stackdriver_GKE_error-log.png</p>
<p>On the logging console, you can perform any type of text search, or try out the various filters by log type, log level, timeframe, etc.</p>
<p>Viewing Log Exports
The Terraform configuration built out two Log Export Sinks. To view the sinks perform the following steps:</p>
<p>you should still be on the Stackdriver -&gt; Logging page.</p>
<p>In the left navigation menu, click on the Exports menu option.</p>
<p>This will bring you to the Exports page. You should see two Sinks in the list of log exports.</p>
<p>You can edit/view these sinks by clicking on the context menu (three dots) to the right of a sink and selecting the Edit sink option.</p>
<p>Additionally, you could create additional custom export sinks by clicking on the Create Export option in the top of the navigation window.</p>
<p>Logs in Cloud Storage
Log events can be stored in Cloud Storage, an object storage system suitable for archiving data. Policies can be configured for Cloud Storage buckets that, for instance, allow aging data to expire and be deleted while more recent data can be stored with a variety of storage classes affecting price and availability.</p>
<p>The Terraform configuration created a Cloud Storage Bucket named stackdriver-gke-logging- to which logs will be exported for medium to long-term archival. In this example, the Storage Class for the bucket is defined as Nearline because the logs should be infrequently accessed in a normal production environment (this will help to manage the costs of medium-term storage). In a production scenario, this bucket may also include a lifecycle policy that moves the content to Coldline storage for cheaper long-term storage of logs.</p>
<p>To access the Stackdriver logs in Cloud Storage perform the following steps:</p>
<p>In the GCP Console from the Navigation menu click Storage.
Find the Bucket with the name stackdriver-gke-logging-<random-Id>, and click on the name.
You should see a list of directories corresponding to pods running in the cluster (e.g. autoscaler, dnsmasq, etc.).
Cloud Storage Bucket</p>
<p>You can click into any of the folders to browse specific log details like heapster, kubedns, sidecar, etc.</p>
<p>Logs in BigQuery
Stackdriver log events can be configured to be published to BigQuery, a data warehouse tool that supports fast, sophisticated, querying over large data sets.</p>
<p>The Terraform configuration will create a BigQuery DataSet named gke_logs_dataset. This dataset will be setup to include all Kubernetes Engine related logs for the last hour (by setting a Default Table Expiration for the dataset). A Stackdriver Export will be created that pushes Kubernetes Engine container logs to the dataset.</p>
<p>To access the Stackdriver logs in BigQuery, perform the following steps:</p>
<p>Note: The BigQuery Export is not populated immediately. It may take a few moments for logs to appear.</p>
<p>On the GCP console from Navigation menu, in the Big Data section, click on BigQuery.
In the left menu, click on your project name. You should see a dataset named gke_logs_dataset. Expand this dataset to view the tables that exist (Note: The dataset is created immediately, but the tables are what is generated as logs are written and new tables are needed).
Click on one of the tables to view the table details.
Review the schema of the table to note the column names and their data types. This information can be used in the next step when you query the table to look at the data.
BQ_logs_dataset.png</p>
<p>Click on Query Table towards the top right to perform a custom query against the table.
This adds a query to the Query Editor, but it has a syntax error.
Edit the query to add an asterisk (*) after Select to pull in all details from the current table. Note: A Select * query is generally very expensive and not advised. For this lab the dataset is limited to only the last hour of logs, so the overall dataset is relatively small.
Click Run to execute the query and return some results from the table.
The results window should display some rows and columns. You can scroll through the various rows of data that are returned. If you want, execute some custom queries that filter for specific data based on the results that were shown in the original query.</p>
<p>Test Completed Task
Click Check my progress to verify your performed task. If BigQuery sink written logs in BigQuery dataset, you will see an assessment score.</p>
<p>View Logs in BigQuery
Teardown
Qwiklabs will take care of shutting down all the resources used for this lab, but here’s what you would need to do to clean up your own environment to save on cost and to be a good cloud citizen:</p>
<p>make teardown</p>
<p>Since Terraform tracks the resources it created it is able to tear them all down.</p>
<p>Troubleshooting for your production environment
The install script fails with a Permission denied when running Terraform.
The credentials that Terraform is using do not provide the necessary permissions to create resources in the selected projects. Ensure that the account listed in gcloud config list has necessary permissions to create resources. If it does, regenerate the application default credentials using gcloud auth application-default login.</p>
<p>Cloud Storage Bucket not populated
Once the Terraform configuration is complete the Cloud Storage Bucket will be created, but it is not always populated immediately with log data from the Kubernetes Engine cluster. Give the process some time because it can take up to 2 to 3 hours before the first entries start appearing (<a href="https://cloud.google.com/logging/docs/export/using_exported_logs)">https://cloud.google.com/logging/docs/export/using_exported_logs)</a>.</p>
<p>No tables created in the BigQuery dataset
Once the Terraform configuration is complete the BigQuery Dataset will be created but it will not always have tables created in it by the time you go to review the results. The tables are rarely populated immediately. Give the process some time (minimum of 5 minutes) before determining that something is not working properly.</p>
<p><em>Bigquery dataset에 테이블이 존재하지 않을때</em>
테라폼 설정이 완료되어</p>
<p>Congratulations
Enterprise-Customers.png stackdriver-logging-badge.png</p>
<p>Finish Your Quest
This self-paced lab is part of the Qwiklabs Google Kubernetes Engine Best Practices and Stackdriver Logging Quests. A Quest is a series of related labs that form a learning path. Completing a Quest earns you a badge to recognize your achievement. You can make your badge (or badges) public and link to them in your online resume or social media account. Enroll in either Quest and get immediate completion credit if you&rsquo;ve taken this lab. See other available Qwiklabs Quests.</p>
<p>Next Steps / Learn More
Kubernetes Engine Logging
Viewing Logs
Advanced Logs Filters
Overview of Logs Exports
Procesing Logs at Scale Using Cloud Dataflow
Terraform Google Cloud Provider
Google Cloud Training &amp; Certification
&hellip;helps you make the most of Google Cloud technologies. Our classes include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. Certifications help you validate and prove your skill and expertise in Google Cloud technologies.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-cc8e3e9b4e558982e4f8ac1a2a319e49">golang slice</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-10" class="text-muted">2019.10.10</time>
        
	</div>
	<p>slice에서</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">bSlice</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">string</span>
<span style="color:#000">aSlice</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">getSlice</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">param</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">// getSlice에서는 slice를 make하고 return한다
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">bSlice</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">aSlice</span>
</code></pre></div><p>이렇게 하면 bSlice와 aSlice는 같은 Slice를 보고 있게 된다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">bSlice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;first&#34;</span>
<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aSlice</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#8f5902;font-style:italic">// first
</span></code></pre></div><p>즉, 두 개의 slice 포인터가 내부적으로는 같은 slice를 바라보게 되는것이다.
주의해서 사용해야하지만, 메모리를 약간이라도 아낄수있다. 메모리 할당을 두번할걸 한번으로 줄였기 때문이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">IntersectionString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">left</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">right</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">string</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">m</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">make</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">]</span><span style="color:#204a87;font-weight:bold">bool</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">left</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">m</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">res</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">string</span>
	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">right</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ok</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">m</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#000">res</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">res</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
		<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">res</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>이는 두 []string slice의 교집합을 찾는 함수이다. 일단 bool 타입을 값을 가지는 map으로 만든후, 왼쪽 slice의 값을 모두 key로 만든후 value에 true를 대입한다.</p>
<p>아래는 해당 교집합 함수를 각각 O(n^2)와 O(n)의 시간복잡도를 가지는 두 테스트 함수로 시간을 비교하는 테스트 함수이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">TestIntersectionSpeed</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">testing</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">T</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">a</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">int</span>
	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">10000000</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">a</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">b</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">int</span>
	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">int</span>

	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">300000</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">c</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">rand</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Intn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">100000</span><span style="color:#000;font-weight:bold">)</span>
		<span style="color:#000">b</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000;font-weight:bold">}</span>

	<span style="color:#000">boolMap</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">make</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">]</span><span style="color:#204a87;font-weight:bold">bool</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#000">t</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test double loop&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">testing</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">T</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">commonId</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">int</span>
		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">val</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">b</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">valA</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">a</span> <span style="color:#000;font-weight:bold">{</span>
				<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">valA</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">val</span> <span style="color:#000;font-weight:bold">{</span>
					<span style="color:#000">a</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">commonId</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">val</span><span style="color:#000;font-weight:bold">)</span>
				<span style="color:#000;font-weight:bold">}</span>
			<span style="color:#000;font-weight:bold">}</span>
		<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">})</span>
	
	<span style="color:#000">t</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test single loop&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">testing</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">T</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">id</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">b</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#000">boolMap</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span>
		<span style="color:#000;font-weight:bold">}</span>
		<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">commonId</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">int</span>
		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">val</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">a</span> <span style="color:#000;font-weight:bold">{</span>
			<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ok</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">boolMap</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">val</span><span style="color:#000;font-weight:bold">];</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">{</span>
				<span style="color:#000">commonId</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">commonId</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">val</span><span style="color:#000;font-weight:bold">)</span>
			<span style="color:#000;font-weight:bold">}</span>
		<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">})</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>하지만 놀랍게도,</p>
<pre><code>=== RUN   Test
--- PASS: Test (0.27s)
=== RUN   Test/test_double_loop
    --- PASS: Test2/test_double_loop (0.01s)
=== RUN   Test/test_single_loop
    --- PASS: Test2/test_single_loop (0.02s)
	PASS
</code></pre><p>밑에 꺼가 더 오래걸리게 나온다.</p>
<p>Slice는 참조시에 메모리가 붙어서 더 빠르게 가능하다는 이야기를 하는데, 아래 글을 참조해야한다고 한다.</p>
<p><a href="https://jacking75.github.io/go_PerformanceTuning/">https://jacking75.github.io/go_PerformanceTuning/</a></p>
<p><a href="https://medium.com/swlh/golang-tips-why-pointers-to-slices-are-useful-and-how-ignoring-them-can-lead-to-tricky-bugs-cac90f72e77b">https://medium.com/swlh/golang-tips-why-pointers-to-slices-are-useful-and-how-ignoring-them-can-lead-to-tricky-bugs-cac90f72e77b</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-4224d92d0c2e1fd7e73c91c70622233f">VPC and NAT</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-10-07" class="text-muted">2019.10.07</time>
        
	</div>
	<h1 id="ultimate-setup-for-your-next-golang-project">Ultimate Setup for Your Next Golang Project</h1>
<p><a href="https://towardsdatascience.com/ultimate-setup-for-your-next-golang-project-1cc989ad2a96">https://towardsdatascience.com/ultimate-setup-for-your-next-golang-project-1cc989ad2a96</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-85cddadd9e786089f6ba2938846297ab">Http connection reusing in Go</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-30" class="text-muted">2019.09.30</time>
        
	</div>
	<p><a href="https://stackoverflow.com/questions/17948827/reusing-http-connections-in-golang">https://stackoverflow.com/questions/17948827/reusing-http-connections-in-golang</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-016edfdb0f84384ff5a6c8b520372ac4">VPC and NAT</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-30" class="text-muted">2019.09.30</time>
        
	</div>
	<p>VPC:
<a href="https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098">https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098</a></p>
<h1 id="vpc의-기본-컴포넌트들">VPC의 기본 컴포넌트들</h1>
<h2 id="vpc">VPC</h2>
<p>VPC는 Virtual Private Cloud의 줄임말로 &ldquo;가상 IP 네트워크&rdquo; 로 이해할 수 있다. 이는 클라우드 내에 가상 데이터 센터라고 할 수 있다. VPC내에 있는 서버들끼리는 연결되어있으며, 사설 IP(Private IP)를 통해 서로 통신할 수 있다.</p>
<blockquote>
<p>Note: 사설 IP란?
예를 들어 &lsquo;우리집 주소는 &ldquo;서울시 성동구 마장로 ~&rdquo; 이다&rsquo; 했을때 &ldquo;서울시~&ldquo;는 공인 IP라 할 수 있다. 반면 집 안에서 &ldquo;안방에 있는 손톱깎기 가져와&rdquo; 했을 때 &ldquo;안방&rdquo; 은 사설 IP라고 할 수 있다. 즉 외부에서 어떤 위치를 칭하는 주소는 공인 IP이고 내부에서는 사설 IP로 위치를 찾는다.</p>
</blockquote>
<p>VPC에서 사용하는 사설 IP 주소 대역은 다음과 같다.</p>
<table>
<thead>
<tr>
<th style="text-align:left">주소</th>
<th style="text-align:center">Prefix 비트 수</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">10.<em>.</em>.*</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:left">172.16.<em>.</em></td>
<td style="text-align:center">12</td>
</tr>
<tr>
<td style="text-align:left">192.168.<em>.</em></td>
<td style="text-align:center">16</td>
</tr>
</tbody>
</table>
<p><img src="https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/images/nondefault-vpc-diagram.png" alt=""></p>
<p>특정 VPC는 한 Region에 속해있고, 각각의 VPC는 완전히 독립적이다.</p>
<p>사설 IP 주소를 선택하는거나, subnet을 만드는거, 라우트 테이블, 네트워크 게이트웨이 VPC는 클라우드 상의 다른 가상 네트워크와 논리적으로 분리되어있다. VPC 내에서 리소스를 띄울 수 있는데, 해당 VPC에 특정 IP 주소 범위를 할당하고, 서브넷을 추가하고, 보안 그룹을 연결하고 라우트 테이블을 설정할 수 있다. VPC의 장점은 프라이버시, 보안, 개인정보 데이터 유실같은 측면에서 장점을 가진다.</p>
<h2 id="subnet">Subnet</h2>
<p>서브넷은 대형 네트워크를 소형 네트워크들로 나눈 것이라고 생각하면 된다. 당연히 가용한 IP 주소 범위도 더 작아지게 되지만, 작은 네트워크의 유지관리가 좀 더 수월하고, 다른 네트워크로부터의 보안등을 제공하기 위해 사용한다. 정 서브넷 내부에서 리소스를 띄울 수 있는데, 인터넷에 반드시 연결되어야하는 리소스들을 위해서는 Public 서브넷을 사용하고, 인터넷에 연결될 필요없는 리소스들을 위해서는 Private subnet을 사용하면 된다. 각 서브넷의 리소스를 보호하기 위해서는, 보안 그룹이나 네트워크 접근 제어 리스트(ACL)등 여러가지를 적용할 수 있다.</p>
<h2 id="route-table">Route Table</h2>
<p>라우트 테이블은 트래픽의 방향을 정해주는 안내표이다. 즉, 발생한 네트워크 요청이 올바른 타겟으로 향할 수 있도록 한다. VPC내에 여러개의 라우트 테이블을 가질 수 있다.</p>
<h2 id="internet-gateway">Internet Gateway</h2>
<p>인터넷 게이트웨이는 구축한 가상 네트워크를 외부와 연결하기 위한 관문이다.
<img src="https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/images/internet-gateway-overview-diagram.png" alt=""></p>
<p>위 그림과 같이 Public subnet의 Route Table에 0.0.0.0/0 에서 온 요청을 igw-id로 Mapping한다. 즉, 내부(선택한 사설 IP대역)에서 온 요청이 아닌, 외부(0.0.0.0)에서 온 네트워크 트래픽은 인터넷 게이트웨이로 향하게 하도록 한다.</p>
<h2 id="network-acl-and-security-group">NETWORK ACL and Security Group</h2>
<p>&ldquo;접근 제어 목록&quot;인 ACL은 각 Subnet에 설정할 수 있는 접근 규칙이다. 일종의 방화벽과 비슷하다. 보안그룹은 인스턴스 수준에서 작동하는 반면 VPC는 서브넷 레벨에서 작동한다. 웹 서버냐, 데이터베이스 서버냐에 따라 이 보안 그룹의 Rule은 다를 수 있다. 예를 들어 웹서버에서는 외부의 HTTP/HTTPS 요청을 모두 허용하고 데이터베이스 서버는 HTTP대신 인바운드 MySQL 액세스를 허용하는 규칙을 사용할 수 있다.</p>
<h2 id="nat">NAT</h2>
<p>Private Subnet이 외부와 통신할 때, NAT는 사설IP 주소를 공인 IP와 map해주는 역할을 한다. Public Subnet상에서 Private Subnet 상의 인스턴스의 인바운드/아웃바운드 요청을 처리한다.</p>
<p>Security groups: Security groups are a set of firewall rules that controls the traffic for your instance. In Amazon Firewall the only action that can be carried out is allow. You cannot create a rule to deny. The destination is always the instance on which the service security group is running. You can have a single security group associated with multiple instances.</p>
<p>Customer Gateway — An Amazon VPC VPN connection links your data center (or network) to your Amazon VPC (virtual private cloud). A customer gateway is the anchor on your side of that connection. It can be a physical or software appliance</p>
<p>NAT:</p>
<p><a href="https://blog.lael.be/post/9534">https://blog.lael.be/post/9534</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-01b5fccd3bc6dcf7ca4588c125302d5c">Data consistency</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-27" class="text-muted">2019.09.27</time>
        
	</div>
	<p>global ordering 이 없는 경우:
카톡으로 질문도 안떴는데 대답이 먼저 보이는 경우</p>
<p>Eventual consistency:</p>
<p><a href="https://stackoverflow.com/questions/10078540/eventual-consistency-in-plain-english">https://stackoverflow.com/questions/10078540/eventual-consistency-in-plain-english</a></p>
<p><a href="https://hackernoon.com/eventual-vs-strong-consistency-in-distributed-databases-282fdad37cf7">https://hackernoon.com/eventual-vs-strong-consistency-in-distributed-databases-282fdad37cf7</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-f5e9ba60b472dded5592163b23bd313d">AWS Sessions</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-26" class="text-muted">2019.09.26</time>
        
	</div>
	<p><a href="https://eksworkshop.com/logging/">https://eksworkshop.com/logging/</a></p>
<p>In this Chapter, we will deploy a common Kubernetes logging pattern which consists of the following:</p>
<p>Fluentd is an open source data collector providing a unified logging layer, supported by 500+ plugins connecting to many types of systems.
Elasticsearch is a distributed, RESTful search and analytics engine.
Kibana lets you visualize your Elasticsearch data.</p>
<p>App mesh
Controll flow
Data Flow</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-da90d78651569b6db86744d37c606564">Web Developer 101</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-24" class="text-muted">2019.09.24</time>
        
	</div>
	<p><a href="https://engineering.videoblocks.com/web-architecture-101-a3224e126947">https://engineering.videoblocks.com/web-architecture-101-a3224e126947</a></p>
<p>cmd+ shift+ f =&gt; find in path (goland)</p>
<p>코드 어딧는지 찾기 딱좋다!</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-7e135a0c12503feae8c395be8d8bba88">Go JSON</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-23" class="text-muted">2019.09.23</time>
        
	</div>
	<p><a href="https://medium.com/@masnun/making-http-requests-in-golang-dd123379efe7">https://medium.com/@masnun/making-http-requests-in-golang-dd123379efe7</a></p>
<p><a href="https://stackoverflow.com/questions/17156371/how-to-get-json-response-from-http-get/31129967#31129967">https://stackoverflow.com/questions/17156371/how-to-get-json-response-from-http-get/31129967#31129967</a></p>
<p><a href="https://www.reddit.com/r/golang/comments/4n46oo/question_does_jsondecode_jsonnewdecoder_close_the/">https://www.reddit.com/r/golang/comments/4n46oo/question_does_jsondecode_jsonnewdecoder_close_the/</a></p>
<p><a href="https://www.sohamkamani.com/blog/2017/10/18/parsing-json-in-golang/#parsing-json-strings">https://www.sohamkamani.com/blog/2017/10/18/parsing-json-in-golang/#parsing-json-strings</a></p>
<p>따라서 문자열을 ascii로 전송하혀면 string &gt; utf8 &gt; base64 또는 string &gt; euckr &gt; base64 등의 조합으로 표현 가능합니다.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-2a4201f5d0697dc78990ecced3be44b5">Panic Recover</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-23" class="text-muted">2019.09.23</time>
        
	</div>
	<p>// The recover built-in function allows a program to manage behavior of a
// panicking goroutine. Executing a call to recover inside a deferred
// function (but not any function called by it) stops the panicking sequence
// by restoring normal execution and retrieves the error value passed to the
// call of panic. If recover is called outside the deferred function it will
// not stop a panicking sequence. In this case, or when the goroutine is not
// panicking, or if the argument supplied to panic was nil, recover returns
// nil. Thus the return value from recover reports whether the goroutine is
// panicking.</p>
<p>빌트인 리커버 function은 프로그램이 고루틴 패닉을 관리한다. defer된 함수안에서 recover를 호출하는 것은 일반적인 실행을 복구하고 panic을 호출한 에러값을 회수한다. recover가 그 defer된 함수 밖에서 호출되면 panic 상황을 멈출 수 없을 것이다. 이런 상황에서는, 또는 고루틴이 panic이 아닐때에는, panic으로 공급된</p>
<p><a href="https://haisum.github.io/2017/09/11/golang-ioutil-readall/">https://haisum.github.io/2017/09/11/golang-ioutil-readall/</a></p>
<p><a href="https://mingrammer.com/translation-avoiding-memory-leak-in-golang-api/">https://mingrammer.com/translation-avoiding-memory-leak-in-golang-api/</a></p>
<p><a href="https://ahmet.im/blog/golang-json-decoder-pitfalls/">https://ahmet.im/blog/golang-json-decoder-pitfalls/</a></p>
<p><a href="https://github.com/google/go-github/pull/317">https://github.com/google/go-github/pull/317</a></p>
<p><a href="http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/">http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/</a></p>
<p>Interface!
<a href="https://medium.com/a-journey-with-go/go-understand-the-empty-interface-2d9fc1e5ec72">https://medium.com/a-journey-with-go/go-understand-the-empty-interface-2d9fc1e5ec72</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-b788bed69318261c2d9c7ad15e0672f1">mac local kubernetes setup</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-19" class="text-muted">2019.09.19</time>
        
	</div>
	<h1 id="docker-for-mac">Docker for Mac</h1>
<p>Kubernetes를 이용해서 배포해야할때,
항상 Cloud위에서 수행하는 것보다는 로컬에 테스트 환경을 구축하고 테스트해보는 것이 생산성에 도움이 될 때가 많다. 그리고 그렇게 어렵지 않다.</p>
<p><img src="http://collabnix.com/wp-content/uploads/2019/05/Screen-Shot-2019-05-11-at-6.17.51-PM.png" alt="docker desktop"></p>
<p>docker desktop for mac을 설치하게 되면, Kubernetes가 활성화된 Docker를 사용할 수 있다. 활성화 되어있지 않다면 preference에 들어가서
enable만 해주면 된다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get nodes
<span style="color:#8f5902;font-style:italic"># NAME             STATUS   ROLES    AGE    VERSION</span>
<span style="color:#8f5902;font-style:italic"># docker-desktop   Ready    master   114m   v1.14.6</span>
</code></pre></div><p>잘 출력된다.</p>
<h1 id="간단한-서버로-k8s-test해보기">간단한 서버로 k8s test해보기</h1>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>

<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
	<span style="color:#4e9a06">&#34;net/http&#34;</span>
<span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">HandleFunc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/hello&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">w</span> <span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ResponseWriter</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">req</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Request</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">w</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Write</span><span style="color:#000;font-weight:bold">([]</span><span style="color:#204a87">byte</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello World&#34;</span><span style="color:#000;font-weight:bold">))</span>
	<span style="color:#000;font-weight:bold">})</span>

	<span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ListenAndServe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;:5000&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">nil</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>hello 엔드포인트로 get 을 날리면 response로 Hello World를 출력하는 간단한 서버이다.
이 서버를 컨테이너화 시켜 배포하기 위해 dockerfile을 간단히 작성해본다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">FROM golang:latest

WORKDIR /app

COPY . .

RUN go build -o main .

EXPOSE <span style="color:#0000cf;font-weight:bold">5000</span>
CMD <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#34;./main&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>이 도커파일을 image화 시켜 docker hub에 publish 하면 된다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker login <span style="color:#8f5902;font-style:italic"># docker hub 인증</span>
docker build .
docker tag <span style="color:#ce5c00;font-weight:bold">{</span>image_id<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>/exercise:v1
docker push <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>/exercise:v1
</code></pre></div><p>이제 push 된 이미지를 땡겨와서 kubernetes로 배포하는 배포파일을 만들어본다.</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: exercise
  labels:
    app: exercise
spec:
  replicas: 1
  selector:
    matchLabels:
      app: exercise
  template:
    metadata:
      labels:
        app: exercise
    spec:
      terminationGracePeriodSeconds: 30
      containers:
      - name: exercise
        image: docker.io/{username}/exercise:v1
        imagePullPolicy: Always
        ports:
        - containerPort: 5000
</code></pre><p>replica는 1개로 해서 1개의 팟을 띄워 컨테이너를 올리는 Deployment 오브젝트를 만들어본다. 5000번 포트를 사용하고 있는 서버이기 때문에 container 의 포트를 5000으로 지정해준다.</p>
<blockquote>
<ul>
<li>terminationGracePeriodSeconds: 30 는 pod 종료 시에 graceful shutdown을 위해 30초의 grace period를 두도록 하는 옵션이다.</li>
</ul>
</blockquote>
<ul>
<li>imagePullPolicy는 로컬에 동일한 이름의 이미지가 존재해도, 항상 이미지를 pull하도록 하는 옵션이다.
이 외에도 여러가지 옵션을 테스트 해볼 수 있다.</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubernetes apply -f sample.yml
</code></pre></div><p>이제 pod이 의도한 대로 잘 생겼는지 확인해본다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get pod
<span style="color:#8f5902;font-style:italic"># NAME                       READY   STATUS    RESTARTS   AGE</span>
<span style="color:#8f5902;font-style:italic"># exercise-b97678cfd-mpppx   1/1     Running   0          9s</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl describe pod/exercise-b97678cfd-mpppx <span style="color:#8f5902;font-style:italic"># 아까 조회한 pod의 name을 이용해서 pod의 자세한 리소스를 조회할 수 있다.</span>
kubectl logs pod/exercise-b97678cfd-mpppx <span style="color:#8f5902;font-style:italic"># 해당 팟에서 발생한 로그도 조회 할 수 있다.</span>
</code></pre></div><p>describe를 통해 아래와 같은 이벤트 정보도 조회할 수 있다.</p>
<pre><code>Events:
  Type    Reason     Age   From                     Message
  ----    ------     ----  ----                     -------
  Normal  Scheduled  47s   default-scheduler        Successfully assigned default/exercise-b97678cfd-mpppx to docker-desktop
  Normal  Pulling    45s   kubelet, docker-desktop  Pulling image &quot;docker.io/nayoonhwang/exercise:v1&quot;
  Normal  Pulled     42s   kubelet, docker-desktop  Successfully pulled image &quot;docker.io/nayoonhwang/exercise:v1&quot;
  Normal  Created    42s   kubelet, docker-desktop  Created container exercise
  Normal  Started    41s   kubelet, docker-desktop  Started container exercise
</code></pre><p>정상적으로 동작하는지 테스트해보기 위해서 Hello World 출력을 확인해본다. 컨테이너의 포트와 호스트의 포트를 포워딩해주기 위해(docker run 시에 -p 옵션을 통해 port binding 해주는 것과 같이) 아래와 같이 입력한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl port-forward deployments/exercise <span style="color:#0000cf;font-weight:bold">5000</span>
</code></pre></div><p>exercise라는 이름의 deployment의 5000번 포트를 포워딩 해주는 커맨드이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl localhost:5000/hello
<span style="color:#8f5902;font-style:italic"># Hello World</span>
</code></pre></div><p>컴퓨터에서 돌고있는 쿠버네티스 pod이 정상 동작임을 확인했다. 이제 다른 여러가지 테스트를 수행해볼수 있다~!</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-62c439d6d48797554a516e2000d975e3">golang nil check</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-19" class="text-muted">2019.09.19</time>
        
	</div>
	<h1 id="golang-zero-value">golang zero value</h1>
<p>초기화값이 없는 상태로 선언된 변수들은 각 타입의 zero value값으로 초기화된다.</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>타입</strong></th>
<th style="text-align:left"><strong>값</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">정수(int)</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">실수(float)</td>
<td style="text-align:left">0.0</td>
</tr>
<tr>
<td style="text-align:left">boolean</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">문자열(string)</td>
<td style="text-align:left">&quot;&quot;</td>
</tr>
<tr>
<td style="text-align:left">실수(float)</td>
<td style="text-align:left">0.0</td>
</tr>
<tr>
<td style="text-align:left">interface, slice, channel, map, pointer, function</td>
<td style="text-align:left">0.0</td>
</tr>
</tbody>
</table>
<p>배열(array)이나 구조체(Struct)의 요소(element)들은 각 필드들이 zero value를 가진채 초기화된다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#4e9a06">&#34;fmt&#34;</span>

<span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">hello</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">s</span> <span style="color:#204a87;font-weight:bold">string</span>
	<span style="color:#000">i</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">int</span>
	<span style="color:#000">p</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">hello</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">h</span> <span style="color:#000">hello</span>
	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">h</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#8f5902;font-style:italic">// { [] &lt;nil&gt;}
</span></code></pre></div><p>hello라는 구조체를 정의했을때, 특정값 없이 선언하면, 위와 같이 zero 값이 들어가는걸 알 수 있다.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-d79c3fedd310c9fb9b42d7c0da7c295e">Kubernetes Deployment(삽질)</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2019-09-18" class="text-muted">2019.09.18</time>
        
	</div>
	<p>Kubernetes로 작업할 때 사용하는 것은 Kubectl 이라는 kubernetes 용 cli가 있다. 클러스터를 관리할 때 사용하는데, 쿠버네티스 클러스터 위에 application 배포시 유용하게 사용된다.</p>
<p><a href="https://kubectl.docs.kubernetes.io/pages/kubectl_book/getting_started.html">Kubectl Tutorial</a> 위 링크에 친절하게 설명된 튜토리얼이 있어 따라해보면 좋다.</p>
<p>쿠버네티스에는 Object라는 개념이 있는데, 예를 들어 Application 배포 시에도 이런 배포용 Object를 만들어 사용하는 것이다. 이 Object는 Yaml file 형식으로 표현할 수 있다.</p>
<p>아래는 예시이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps/v1 # apps/v1beta2를 사용하는 1.9.0보다 더 이전의 버전용</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx-deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">replicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 템플릿에 매칭되는 파드 2개를 구동하는 디플로이먼트임</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx:1.7.9</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">80</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>모든 쿠버네티스 오브젝트는 오브젝트의 구성을 결정하는 두 개의 필드 spec status 를 가진다. spec은 우리가 만들 오브젝트가 가져야하는 조건을 의미한다. Kubernetes는 제공된 spec을 기준으로 Object를 생성한다.
status 는 오브젝트의 실제 상태를 나타내고, Kubernetes 시스템에 의해 업데이트 된다. Kubernetes는 오브젝트의 실제 상태(status)를 spec에 일치시키기 위해 능동적으로 관리한다.
예를 들어 위 yaml을 기준으로 object를 생성 했을때 spec에 정의된 replicas: 2 에 의해 2개의 인스턴스를 생성하여 컨테이너를 띄운다.
만약 그 중 1개에서 Fail 이 발생한다면, Kubernetes 시스템에서 자체적으로 대체 인스턴스를 생성하여 spec과 status 간의 차이를 제거하려할 것이다.</p>
<p>Pod은 Kubernetes의 가장 작은 개념이자 핵심 개념이다. 한개의 팟은 Application의 한 인스턴스로 동등하다. 그리고 이 인스턴스는 보통 한 개의 컨테이너다. 팟 하나에 하나의 ip 주소를 가지고 있다.
즉, 한 pod은 한 컨테이너가 동작하는 한개의 인스턴스이다. 물론 여러개 컨테이너가 올라갈 수도 있지만, 난 간단히 한 pod에 한 컨테이너라고 이해하고 진행했다. 팟은 보통 직접만들기 보다는, 싱글톤(Singleton) 이라도 대부분 위와 같이 Deployment와 같은 컨트롤러를 사용한다. 컨트롤러는 클러스터 범위에서 복제와 롤아웃(Rollout) 관리 뿐만 아니라 자가치료 기능도 제공한다.</p>
<p><a href="https://kubernetes.io/ko/docs/concepts/workloads/pods/pod/">참고</a></p>
<h2 id="object-생성하기">Object 생성하기</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f config.yml
</code></pre></div><p>yaml file 에 정의한 바를 기반으로 deployment/service를 생성할 수 있다. 다른 방식으로도 생성할 수 있지만, 이렇게 생성하는 것을 권장하고 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create -f config.yml
</code></pre></div><p>이런식으로 생성해도 되지만, apply를 해도 만약 해당 이름의 deployment가 존재하지 않을 경우 생성해주기 때문에 create를 굳이 쓸필요가없다.</p>
<p>환경변수 설정시 등에서 활용할 수 있는 Configmap의 예시를 한번 들어보면, 아래와 같은 식으로 special-config라는 이름의 Configmap을 정의한 후에 </p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">special-config</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">SPECIAL_LEVEL</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">very</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">SPECIAL_TYPE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">charm</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>apply를 통해 만들어준다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f config.yml
<span style="color:#8f5902;font-style:italic"># configmap/special-config created</span>
kubectl get configmaps
<span style="color:#8f5902;font-style:italic"># NAME             DATA   AGE</span>
<span style="color:#8f5902;font-style:italic"># special-config   2      8s</span>
</code></pre></div><p>만들어준 configmap은 pod 생성시에 아래와 같은 식으로 참조하여 사용할 수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dapi-test-pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-container</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">k8s.gcr.io/busybox</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/bin/sh&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;-c&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;env&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">envFrom</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">configMapRef</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">	  		</span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">special-config</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">envFrom:
- configMapRef:
	name: special-config
</code></pre></div><p>이렇게 정의하면 special-config내에 data에 정의한 모든 변수들을 container의 환경변수로 사용할 수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">env:
- name: SPECIAL_LEVEL_KEY
  valueFrom:
    configMapKeyRef:
      name: special-config
      key: SPECIAL_LEVEL
</code></pre></div><p>이렇게 envFrom와 configMapRef 키워드 대신 env와 configMapKeyRef로 정의하면 speical-config configmap에서 원하는 변수를 정의해서 쓸 수 있다. 아무래도 위에 있는 envFrom 이 좀 더 쉽게 사용할 수 있는 방법이다.</p>
<h2 id="deploy-updated-application">Deploy Updated Application</h2>
<p>그렇다면 이미 돌아가고 있는 Instance을 업데이트 해야할 땐 어떻게 해야할까. 예를 들어 application에 변동 사항이 생겼고, source code에 변동이 생겼으니, build artifact가 달라졌을것이다. release나 master 같은 경우엔 당연히 build-number/ release-number를 다르게 해서 image에 tag를 달아주고 해당 image를 참조하여 build 하도록 하면 config.yml에 매번 변동이 생기기 때문에 pod를 rolling update 한다. 하지만 develop같은 경우엔 어떻게 될까. develop같은 경우엔 변동사항이 많고 굳이 release-number / build-number를 관리하지 않는다.</p>
<p><a href="https://stackoverflow.com/questions/40366192/kubernetes-how-to-make-deployment-to-update-image">stackoverflow 에 많은 질문들</a>이 올라와있다. <a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/declarative-config/">공식 Kubernetes 가이드</a>등을 참조해봤을 때,</p>
<pre><code>kubernetes set image deployments/{my_deployment} {container_name}={image_repo_url}:{tag_name}
</code></pre><p>요 set 커맨드를 이용해서 뭔가를 update를 줘서 kubernetes가 rolling update를 수행할 수 있게 하라는 답변들이 가장 많았다. 일단 rolling update를 수행하게 되면,</p>
<blockquote>
<p>imagePullPolicy: Always</p>
</blockquote>
<p>요 imagePullPolicy가 Always로 설정되어있을때, 항상 image를 repository에서 pull 땡겨오기 때문에 같은 tag를 가진 이미지라도 업데이트된 이미지가 존재할때 해당 업데이트를 받아올수 있다.</p>
<p>사실 Rolling Restart 라는 개념을 이때 사용하면 딱 괜찮은데, <a href="https://github.com/kubernetes/kubernetes/issues/13488">이슈</a>가 이미 존재했고, 1.15 버전부터는</p>
<pre><code>kubectl rollout restart {pod}
</code></pre><p>라는 커맨드가 생겨서 한번에 해결할 수 있다.</p>
<p>하지만 우리가 사용하고 있는 버전이 1.14여서 해당 커맨드를 사용할 수 없는데, 이땐 각종 야매 방법을 써야한다</p>
<p><a href="https://techoverflow.net/2019/04/02/how-to-force-restarting-all-pods-in-a-kubernetes-deployment/">야매1</a> 뭐 이런 방법이 있을 수 있고, tag가 latest일 경우에는,</p>
<pre><code>kubectl set image deployments/exercise exercise=docker.io/{username}/exercise:latest
kubectl set image deployments/exercise exercise=docker.io/{username}/exercise
</code></pre><p>이런식으로 두 번 치는걸로 이미지를 강제 업데이트 시켜 rolling update를 유도할 수 있다. 단 이 방법은 tag 가 latest일때만 작동한다. develop같이 branch 이름으로 하는 경우에는 또 동작하지않는다.</p>
<p>이를 다 테스트 해보기 위해 로컬에 kubernetes를 설치하고 하나하나 해봤는데, 다행히 Mac에는 Docker for Mac을 이용하면 쉽게 설치할 수 있었다.</p>
<p><a href="https://eksworkshop.com/logging/">https://eksworkshop.com/logging/</a></p>

</div>





    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="User mailing list" aria-label="User mailing list">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://example.org/mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://example.org/twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://example.org/stack">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/matilda38">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Developer mailing list" aria-label="Developer mailing list">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="matilda38@naver.com">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 The Docsy Authors All Rights Reserved</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank">개인정보 보호 정책</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>











<script src="/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js" integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin="anonymous"></script>




  </body>
</html>
